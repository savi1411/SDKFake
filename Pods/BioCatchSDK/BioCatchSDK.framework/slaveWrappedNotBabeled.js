/* slave version: 2.4.0.3282.d394953 Sun May 13 2018 13:02:59 */

!function(){new function(){"use strict";function e(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function t(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=this,s=function o(e,t,n){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,t);if(i===undefined){var s=Object.getPrototypeOf(e);return null===s?undefined:o(s,t,n)}if("value"in i)return i.value;var r=i.get;return r===undefined?undefined:r.call(n)},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){if(Object.getOwnPropertyNames||(Object.getOwnPropertyNames=function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}),!Object.defineProperty||!function(){try{return Object.defineProperty({},"x",{}),!0}catch(e){return!1}}()){var t=Object.defineProperty;Object.defineProperty=function(e,n,i){if(t)try{return t(e,n,i)}catch(s){}if(e!==Object(e))throw TypeError("Object.defineProperty called on non-object");return Object.prototype.__defineGetter__&&"get"in i&&Object.prototype.__defineGetter__.call(e,n,i.get),Object.prototype.__defineSetter__&&"set"in i&&Object.prototype.__defineSetter__.call(e,n,i.set),"value"in i&&(e[n]=i.value),e}}"function"!=typeof Object.defineProperties&&(Object.defineProperties=function(e,t){if(e!==Object(e))throw TypeError("Object.defineProperties called on non-object");var n;for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&Object.defineProperty(e,n,t[n]);return e}),"function"!=typeof Object.create&&(Object.create=function(e,t){function n(){}if("object"!==("undefined"==typeof e?"undefined":a(e)))throw TypeError();n.prototype=e;var i=new n;if(e&&(i.constructor=n),t!==undefined){if(t!==Object(t))throw TypeError();Object.defineProperties(i,t)}return i}),Object.keys||(Object.keys=function(e){if(e!==Object(e))throw TypeError("Object.keys called on non-object");var t,n=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.push(t);return n}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var n,i;if(null==this)throw new TypeError(" this is null or not defined");var s=Object(this),r=s.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(n=t),i=0;i<r;){var a;i in s&&(a=s[i],e.call(n,a,i,s)),i++}}),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),Function.prototype.bind||(Function.prototype.bind=function(e){function t(){}if("function"!=typeof this)throw TypeError("Bind must be called on a function");var n=[].slice,i=n.call(arguments,1),s=this,r=function(){return s.apply(this.prototype&&this instanceof t?this:e,i.concat(n.call(arguments)))};return t.prototype=s.prototype,r.prototype=new t,r}),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")})}(),function(e){function t(){this._listeners=[]}e.CDEvent||(t.prototype={subscribe:function(e){this._listeners.push(e)},publish:function(e){for(var t=0,n=this._listeners.length;t<n;t++)this._listeners[t](e)},unsubscribe:function(e){for(var t=0,n=this._listeners.length;t<n;t++)if(e===this._listeners[t]){this._listeners.splice(t,1);break}}},e.CDEvent=t)}(i),function(e){function t(){this._map={}}t.prototype.get=function(e){return this._map[e]},t.prototype.set=function(e,t){return this._map[e]=t,this},t.prototype.has=function(e){return this._map.hasOwnProperty(e)},t.prototype["delete"]=function(e){return!!this.has(e)&&(delete this._map[e],!0)},e.Map=self.Map||t}(i),function(e){function t(e,t){this._portNativeWorker=e,this._useShared=t}t.prototype={start:function(){this._useShared&&this._portNativeWorker.port.start()},postMessage:function(){var e=this._portNativeWorker.port;this._useShared?e.postMessage.apply(e,arguments):this._portNativeWorker.postMessage.apply(this._portNativeWorker,arguments)},close:function(){this._useShared?this._portNativeWorker.port.close():this._portNativeWorker.terminate()},setonmessage:function(e){this._useShared?this._portNativeWorker.port.onmessage=e:this._portNativeWorker.onmessage=e}},e.CDPort=t}(i),function(e){function t(){this._set=[]}t.prototype.add=function(e){return this._set.push(e),this},t.prototype["delete"]=function(e){for(var t=0;t<this._set.length;t++)if(this._set[t]===e)return this._set.splice(t,1),!0;return!1},t.prototype.forEach=function(e){for(var t=0;t<this._set.length;t++)e(this._set[t])},e.Set=self.Set||t}(i),i.DataMappingDefs={ELEMENT_EVENT_MAP:["eventSequence","relativeTime","eventType","isTrusted","elementHash","length","elementValues","selected"],ELEMENT_MAP:["elementHash","tagName","id","name","type","leftPosition","topPosition","width","height","className","href","title","alt","selectValues","elementValue","checked","timestamp"],CLIPBOARD_EVENT_MAP:["eventSequence","relativeTime","clipboardEventType","elementHash","copiedText"],KEY_EVENT_MAP:["eventSequence","relativeTime","eventType","isTrusted","elementHash","charCode","character","keyComboType","isCtrl","isShift","isAlt","isMetaKey","keyLocation","code","key","isRepeat"],MOUSE_EVENT_MAP:["eventSequence","relativeTime","eventType","isTrusted","elementHash","pageX","pageY","screenX","screenY","button","wheelDelta","clientX","clientY","eventDetail","buttonNew"],WINDOW_EVENT_MAP:["eventSequence","relativeTime","eventType","isTrusted","screenWidth","screenHeight","clientWidth","clientHeight","documentWidth","documentHeight","scrollTop","scrollLeft","windowInnerWidth","windowInnerHeight","windowOuterWidth","windowOuterHeight"],TOUCH_EVENT_MAP:["eventSequence","relativeTime","eventType","isTrusted","elementHash","clientX","clientY","touchIndex","touchSizeMajor","touchSizeMinor","pageX","pageY","screenX","screenY"],ACCELEROMETER_EVENT_MAP:["eventSequence","relativeTime","x","y","z"],GESTURE_EVENT_MAP:["eventSequence","relativeTime","eventType","scale","rotation","pointerType","overallVelocity","direction","pageX","pageY","screenX","screenY","clientX","clientY"],GYRO_EVENT_MAP:["eventSequence","relativeTime","absolute","alpha","beta","gamma"],ORIENTATION_EVENT_MAP:["eventSequence","relativeTime","absolute","alpha","beta","gamma"],SCRIPT_EVENT_MAP:["eventSequence","relativeTime","eventType","scriptId","namespaceURI","outerHTML","scriptSource","scriptType"],SCREEN_ORIENTATION_EVENT_MAP:["eventSequence","timestamp","orientation"],TAP_EVENT_MAP:["eventSequence","relativeTime","screenX","screenY","pageX","pageY","clientX","clientY","isTrusted","elementHash","touchIndex","touchSizeMajor","touchSizeMinor"],LONGPRESS_EVENT_MAP:["eventSequence","relativeTime","screenX","screenY","pageX","pageY","clientX","clientY","isTrusted","elementHash","touchIndex","touchSizeMajor","touchSizeMinor"],TAB_EVENT_MAP:["eventSequence","timestamp","type","id","href","referrer","currentTabsList"],NETINFO_EVENT_MAP:["eventSequence","timestamp","connectionType","effectiveType","downlinkMax","downlink","rtt","isSaveData"]},function(e){var t=function(){function t(i){n(this,t),this._perfDataQ=i,this._now=window.performance&&window.performance.now?window.performance.now.bind(window.performance):e.CDUtils.dateNow.bind(Date),this._monitors=new e.Map}return r(t,[{key:"startMonitor",value:function(e){log.debug("PerfMonitor:startMonitor on "+e),this._monitors.set(e,this._now())}},{key:"stopMonitor",value:function(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"main";if(this._monitors.has(e)){var n=this._now()-this._monitors.get(e);this._perfDataQ.addToQueue("perf",{orig:t,name:e,val:n}),log.debug("PerfMonitor:stopMonitor on "+e+": time = "+n),this._monitors["delete"](e)}}},{key:"cancelMonitor",value:function(e){log.debug("PerfMonitor:cancelMonitor on "+e),this._monitors.has(e)&&this._monitors["delete"](e)}},{key:"reportMonitor",value:function(e,t){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"main";log.debug("PerfMonitor:reportMonitor on "+e),this._perfDataQ.addToQueue("perf",{orig:n,name:e,val:t})}}]),t}();e.PerfMonitor=t}(i),function(e){function t(){this._msgListeners=new e.Map}e.WorkerCommunicator||(t.prototype.setMessagingPort=function(e){this._messagePort=e;var t=this;e.setonmessage(function(e){var n=e.data,i=t._msgListeners.get(n.msgType);i&&i.forEach(function(e){e.callback(n.data),e.isOneTime&&i["delete"](e)})})},t.prototype.sendAsync=function(e,t,n,i,s){i&&n&&this.addMessageListener(n,i,s),this._messagePort.postMessage({msgType:e,data:t})},t.prototype.addMessageListener=function(t,n,i){var s=null;this._msgListeners.has(t)?s=this._msgListeners.get(t):(s=new e.Set,this._msgListeners.set(t,s)),s.add({callback:n,isOneTime:i})},e.WorkerCommunicator=t)}(i),function(e){var t=function(){function t(i){n(this,t),this._nativeWorker=i;var s=!!window.SharedWorker&&this._nativeWorker instanceof window.SharedWorker;this.port=new e.CDPort(this._nativeWorker,s)}return r(t,[{key:"close",value:function(){this.port&&this.port.close()}}]),t}();e.WorkerWrapper=t}(i),function(e){var t=function(){function t(){n(this,t)}return r(t,[{key:"create",value:function(t){var n=new(window.Worker||window.SharedWorker)(t);return new e.WorkerWrapper(n)}}]),t}();e.WorkerWrapperFactory=t}(i),i.EnumDefs={Events:{isTrusted:{"false":0,"true":1,undefined:2,"null":2},elementEventType:{input:0,initial:1,focus:2,blur:3,change:4,click:5,submit:6},clipboardEventType:{copy:0,paste:1,cut:2},keyEventType:{keyup:0,keydown:1,keypress:2},mouseEventType:{mousemove:0,mousedown:1,mouseup:2,click:3,dblclick:4,mouseleave:5,mouseenter:6,wheel:7,mouseout:8,mouseover:9},windowEventType:{DOMContentLoaded:0,scroll:1,resize:2,focus:3,blur:4,tabFocus:5,tabBlur:6},touchEventIEType:{pointerdown:"touchstart",pointerup:"touchend",pointermove:"touchmove",MSPointerDown:"touchstart",MSPointerUp:"touchend",MSPointerMove:"touchmove"},touchEventType:{touchstart:0,touchmove:1,touchend:2,touchcancel:3},getstureEventType:{pinch:0,press:1,swipe:2,rotate:3},scriptEventType:{load:0},screenOrientationType:{undefined:0,"portrait-primary":1,"landscape-primary":2,"portrait-secondary":3,"landscape-secondary":4},tabEventType:{openTab:0,newTab:1,closeTab:2}},SNUM_CHANGE_TYPE:{none:"none",init:"init",configuration:"config",configurationFromSlave:"configFromSlave",customerApi:"customerApi",pageTimeout:"timeout",serverRequest:"serverRequest",unknown:"unknown"},MasterSlaveMessage:{dataFromSlave:"dataFromSlave",registerSlave:"registerSlave",logPerfSlave:"logPerfSlave",updateSlaveConf:"updateSlaveConf",updateSlaveState:"updateSlaveState",updateMasterContext:"updateMasterContext",resetSessionTriggerFromSlave:"resetSessionTriggerFromSlave",mouseChallengeTriggerFromSlave:"mouseChallengeTriggerFromSlave"},SystemFrameName:{rtcframe:"cd__rtcframe",fontDetectionFrame:"cd__fontDetectionFrame"},MessageBusTypes:{TouchEvent:"touchEvent"}},function(e){e.DomUtils={outerHTML:function(e){return e.outerHTML||(new XMLSerializer).serializeToString(e)},getXPath:function(e){for(var t=[],n=(e.id||"")+(e.name||"")+(e.nodeName||"")+(e.className||"")+(e.title||"")+(e.href||"");e&&1===e.nodeType;e=e.parentNode){for(var i=0,s=e.previousSibling;s;s=s.previousSibling)s.nodeType!==Node.DOCUMENT_TYPE_NODE&&s.nodeName===e.nodeName&&++i;var r=e.nodeName.toLowerCase()+(e.id||"")+(e.name||"")+(e.href||"")+(e.getAttribute&&e.getAttribute("class")||"")+(e.title||""),a=i||"";t.splice(0,0,r+a)}return n+=t.length?"/"+t.join():""},onDocumentBody:function(e,t){e.document.body?t():(window.addEventListener?window.addEventListener("DOMContentLoaded",t,!0):window.attachEvent("onload",t),log.debug("DomUtils:onDocumentBody - no document body found, listening"))},onPageLoad:function(t,n){e.CDUtils.addEventListener(t,"load",n,!0),(t.contentWindow&&"complete"===t.contentWindow.document.readyState||t.document&&"complete"===t.document.readyState)&&n()},onWindowDocumentReady:function(t,n){var i=window.addEventListener?"DOMContentLoaded":"load";"complete"===t.document.readyState||"interactive"===t.document.readyState?n():e.CDUtils.addEventListener(t,i,function s(){e.CDUtils.removeEventListener(t,i,s,!0),n()},!0)},isWindowDocumentReady:function(e){return e&&"complete"===e.document.readyState},canAccessIFrame:function(e){var t=null;try{t=(e.contentDocument||e.contentWindow.document).body.innerHTML}catch(n){}return null!==t}}}(i),function(e){var t=function(){var e=null;return function(t,n,i){var s=function(){return n};if(n.toString().indexOf("[native code]")>-1)i(s());else{var r=void 0,a=0;e||((e=document.createElement("IFRAME")).style.display="none",document.documentElement.appendChild(e)),function o(){if(e.contentWindow){for(var n=e.contentWindow,u=t.split("."),c=n,l=0;l<u.length;l++)c=c[u[l]];i(c)}else a<45?(r=setTimeout(o,a),a++):i(s())}()}}}();e.CDUtils={scriptVersion:"@@scriptVersion",isPassiveSupported:function(){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("test",null,t)}catch(n){}return e}(),dateNow:Date.now,isUndefinedNull:function(e){return null===e||e===undefined||"undefined"==typeof e},addEventListener:function(e,t,n){var i=arguments.length>3&&arguments[3]!==undefined&&arguments[3],s=!(arguments.length>4&&arguments[4]!==undefined)||arguments[4],r=arguments.length>5&&arguments[5]!==undefined&&arguments[5];this.isPassiveSupported?e.addEventListener(t,n,{capture:i,passive:s,once:r}):e.addEventListener?e.addEventListener(t,n,i):e.attachEvent("on"+t,n)},removeEventListener:function(e,t,n){var i=arguments.length>3&&arguments[3]!==undefined&&arguments[3];e.removeEventListener?e.removeEventListener(t,n,i):e.detachEvent("on"+t,n)},clearTextFromNumbers:function(e){return e?e.replace(/(\d)/g,"*"):""},maskText:function(e){return e.replace(/[\d]/g,"1").replace(/[a-zA-Z]/g,"a").replace(/[^a-zA-Z\d\u0000-\u0080]/g,"*")},getDropDownListValues:function(t){for(var n=[],i=0;i<t.length;i++){var s=t.options[i].text||t.options[i].value;n.push(e.CDUtils.maskText(s))}return n},getDocUrl:function(){var t=window.location;return t.protocol+"//"+t.hostname+(t.port?":"+t.port:"")+e.CDUtils.clearTextFromNumbers(t.pathname)},getHash:function(e){for(var t=0,n=0,i=e.length;n<i;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;return t},generateUUID:function(){var t=e.CDUtils.dateNow();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?n:3&n|8).toString(16)})},convertToArrayByMap:function(e,t){for(var n=[null],i=0,s=e.length;i<s;i++)n[i+1]=t[e[i]];return n},getMapCode:function(e){var t=String.fromCharCode(e);return/[0-9]/.test(t)?49:/[a-zA-Z]/.test(t)?65:/[^\u0000-\u0080]/.test(t)?66:e},getPostUrl:function(e,t,n,i,s,r,a){var o=!!self.XDomainRequest,u=o?new XDomainRequest:new XMLHttpRequest;o?(u.onload=function(){i&&i(u.responseText)},u.onerror=function(){s&&s()},u.onprogress=function(){},u.ontimeout=function(){},u.open(t,e,!0),setTimeout(function(){u.send(n)},0)):(u.open(t,e,!0),a!==undefined&&(u.timeout=a),u.withCredentials=!1!==r,"POST"===t&&u.setRequestHeader("Content-Type","application/json; charset=utf-8"),u.onreadystatechange=function(){if(4==u.readyState){if(204==u.status)return;200==u.status?i&&i(u.responseText):s&&s(u.responseText)}},u.ontimeout=function(){s&&s("timeout",n)},u.send(n))},minutesToMilliseconds:function(e){return 60*e*1e3},DomUtils:e.DomUtils,EnumDefs:e.EnumDefs,StorageUtils:{counter:0,getAndUpdateEventSequenceNumber:function(){return this.counter++},deserialize:function(e){if("string"!=typeof e)return null;try{return JSON.parse(e)}catch(t){return e||null}},getFromLocalStorage:function(t,n){try{var i=this.deserialize(window.localStorage.getItem(t));return i?i.exp&&e.CDUtils.dateNow()-i.time>i.exp?null:n==undefined||n?i.val:i:null}catch(s){return null}},saveToLocalStorage:function(t,n,i){var s={val:n};i&&(s.exp=i,s.time=e.CDUtils.dateNow());try{window.localStorage.setItem(t,JSON.stringify(s))}catch(r){return null}return s},removeFromLocalStorage:function(e){try{window.localStorage.removeItem(e)}catch(t){return null}},getFromSessionStorage:function(e){try{var t=this.deserialize(window.sessionStorage.getItem(e));return t||null}catch(n){return null}},saveToSessionStorage:function(e,t){try{return t?(window.sessionStorage.setItem(e,JSON.stringify(t)),t):window.sessionStorage.removeItem(e)}catch(n){return null}},removeFromSessionStorage:function(e){try{window.sessionStorage.removeItem(e)}catch(t){return null}},getCookie:function(e){var t=new RegExp("(?:^|; )"+encodeURIComponent(e)+"=([^;]*)").exec(document.cookie);return t?decodeURIComponent(t[1]):""},setCookie:function(e,t,n){var i="";if(n){var s=new Date;s.setTime(s.getTime()+n),i="; expires="+s.toUTCString()}for(var r=0,a=location.hostname,o=a.split("."),u="",c=!1;r<=o.length-1&&!c;)"localhost"===(a=o.slice(-1-++r).join("."))?u="":""!==a&&(u="; domain=."+a),c=this.setCookieWithAttributes(e,t,i,u);return c||(u="; domain="+location.hostname,c=this.setCookieWithAttributes(e,t,i,u)),c},setCookieWithAttributes:function(e,t,n,i){return document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+n+i+"; path=/",this.getCookie(e)==t},validateBcId:function(e){return/^([0-9]{13,}-)?[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)?e:null}},getNativeWindowFn:t,JQueryUtils:{isJQueryAvailable:function(){return window.jQuery!==undefined},addEventListener:function(e,t,n){jQuery(e).on(t,n)},removeEventListener:function(e,t,n){jQuery(e).off(t,n)}}},Date.now?t("Date.now",Date.now,function(t){e.CDUtils.dateNow=t}):e.CDUtils.dateNow=function(){return(new Date).getTime()}}(i),function(e){if(!Function.prototype.cdCallAsync&&(Object.extend=function(e,t){if(e&&t&&"object"==("undefined"==typeof t?"undefined":a(t)))for(var n in t)if(t.hasOwnProperty(n))try{""!=n&&Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}catch(i){e[n]=t[n]}return e},e.btoa=self.btoa?self.btoa.bind(self):function(e){for(var t,n,i=String(e),s="",r=0,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.charAt(0|r)||(a="=",r%1);s+=a.charAt(63&t>>8-r%1*8)){if((n=i.charCodeAt(r+=.75))>255)throw new Error("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");t=t<<8|n}return s},self.importScripts==undefined)){var t=function(){var t=[],n="Window_"+e.CDUtils.generateUUID();return e.CDUtils.addEventListener(window,"message",function(e){e.data==n&&(e.stopPropagation&&e.stopPropagation(),e.returnValue&&(e.returnValue=!1),e.cancelBubble&&(e.cancelBubble=!0),t.shift()())},!0),function(e){t.push(e),window.postMessage(n,self.location.href)}}();Function.prototype.cdCallAsync=function(e){for(var n=arguments.length,i=Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];var r=this;t(function(){r.apply(e||window,i)})},Function.prototype.cdCallAsyncWithErrorHandling=function(e,n){for(var i=arguments.length,s=Array(i>2?i-2:0),r=2;r<i;r++)s[r-2]=arguments[r];var a=this;t(function(){try{a.apply(e||window,s)}catch(t){n&&n(t)}})}}}(i),function(e){if(!e.Logger){var t=function(){function e(t,i){n(this,e),this._logBridge=t,this._logLevel=i||e.LOG_LEVEL.INFO}return r(e,[{key:"trace",value:function(t){this._sendToLogBridge(t,e.LOG_LEVEL.DEBUG)}},{key:"debug",value:function(t){this._sendToLogBridge(t,e.LOG_LEVEL.DEBUG)}},{key:"info",value:function(t){this._sendToLogBridge(t,e.LOG_LEVEL.INFO)}},{key:"warn",value:function(t,n){this._sendToLogBridge(t,e.LOG_LEVEL.WARN,n)}},{key:"error",value:function(t,n){this._sendToLogBridge(t,e.LOG_LEVEL.ERROR,n)}},{key:"isDebug",value:function(){return this._logLevel==e.LOG_LEVEL.DEBUG}},{key:"updateLogConfig",value:function(e){this._logLevel=e.get("logLevel")||this._logLevel}},{key:"_sendToLogBridge",value:function(e,t,n){t>=this._logLevel&&(n&&n.stack&&(e+=" ;stack: "+n.stack),this._logBridge.log(e,t))}}]),e}();Object.extend(t,{LOG_LEVEL:{DEBUG:10,INFO:20,WARN:30,ERROR:40,CRITICAL:50,OFF:80}}),e.Logger=t,e.log={setLogger:function(e){this._logger=e},isDebug:function(){return this._logger.isDebug()},error:function(e,t){this._logger.error(e,t||null)},warn:function(e,t){this._logger.warn(e,t||null)},trace:function(e){this._logger.trace(e)},debug:function(e){this._logger.debug(e)},info:function(e){this._logger.info(e)}}}}(i),i.WorkerCommand={initCollectionCommand:"initCollectionCommand",updateSessionParamsCommand:"updateSessionParamsCommand",updateCsidCommand:"updateCsidCommand",updateLogUrlCommand:"updateLogUrl"},function(i){var s=function(){function s(e){n(this,s),i.isUnsupportedMode=!0,this._unsPort=e,this._unsFrameHandler={startFeatures:function(){},startFeature:function(){},stopFeatures:function(){},stopFeature:function(){},updateFeatureConfig:function(){}}}return r(s,[{key:"getUnsPort",value:function(){return this._unsPort}},{key:"getUnsFrameHandler",value:function(){return this._unsFrameHandler}},{key:"adjustFeatureList",value:function(s){function a(e){for(var t in e)e.hasOwnProperty(t)&&!e[t].runInUns&&delete e[t]}a(s.defaultFeatures),a(s.nonDefaultFeatures),a(s.perSessionFeatures),a(s.perContextFeatures),a(s.perPageReloadFeatures),a(s.nonDefaultFeatures),s.perSessionFeatures.IsUnsupportedFeature={configKey:"isUnsupportedReport",shouldRun:!0,isFrameRelated:!1,runInUns:!0,isRunning:!1,init:function(){var s=function(s){function a(){return n(this,a),e(this,(a.__proto__||Object.getPrototypeOf(a)).apply(this,arguments))}return t(a,i.AbstractFeature),r(a,[{key:"startFeature",value:function(){this._dataQ.addToQueue("static_fields",["is_supported",!1],!1)}}]),a}();this._features.perSessionFeatures.IsUnsupportedFeature.instance=new s(this._dataQ)},instance:null}}}]),s}();i.UnsupportedMgr=s}(i),function(e){var t=function(){function e(t,i){n(this,e),this._dataQ=t,this._perfMonitor=i}return r(e,[{key:"preFeature",value:function(e){this._perfMonitor.startMonitor(e)}},{key:"postFeature",value:function(e,t){this._perfMonitor.stopMonitor(e,t)}},{key:"cancelMonitor",value:function(e){this._perfMonitor.cancelMonitor(e)}},{key:"stopFeature",value:function(){}},{key:"updateFeatureConfig",value:function(){}}]),e}();e.AbstractFeature=t}(i),function(e){var t=function(){function t(i){n(this,t),this._perfMonitor=i,this.isPassive=e.CDUtils.isPassiveSupported}return r(t,[{key:"getEventTimestamp",value:function(t){return e.CDUtils.dateNow()}},{key:"handlerProlog",value:function(e){log.isDebug()&&this._perfMonitor.startMonitor(e)}},{key:"handlerEpilog",value:function(e){log.isDebug()&&this._perfMonitor.stopMonitor(e)}},{key:"handlerCancelog",value:function(e){log.isDebug()&&this._perfMonitor.cancelMonitor(e)}},{key:"updateFeatureConfig",value:function(){}}]),t}();e.Events=t}(i),function(e){function t(e,t,n,i){this._configMgr=e,this._utils=t,this._dataQueue=n,this._perfMonitor=i,this._isReady=!0,this._elementHashWMap=new WeakMap,this._collectPosition=!0,this._collectClassName=!0,this._collectTitle=!0,this._collectHref=!0,this._maxElemValLength=30}(t.prototype=Object.create(e.Events.prototype)).constructor=t,t.prototype.getElement=function(t){if(this._utils.isUndefinedNull(t)||t===document||t==document.body)return-1;if(this._elementHashWMap.has(t))return this._elementHashWMap.get(t);this.handlerProlog("t.E_get");var n=this._utils.DomUtils.getXPath(t),i=n?this._utils.getHash(n):-1;this._elementHashWMap.set(t,i);var s=this._collectPosition?t.getBoundingClientRect&&t.getBoundingClientRect():null,r=-1,a=-1,o=-1,u=-1;s&&(r=Math.round(s.left),a=Math.round(s.top),o=Math.round(s.right-s.left),u=Math.round(s.bottom-s.top));var c=this.verifyNoPrivateData(t.id||""),l=this.verifyNoPrivateData(t.name||""),h=this._collectClassName?t.getAttribute&&this.verifyNoPrivateData(t.getAttribute("class"))||"":"",d=this._collectTitle?this.verifyNoPrivateData(t.title)||"":"",f=this.verifyNoPrivateData(t.nodeName)||"",p=this._collectHref?this.verifyNoPrivateData(t.href)||"":"";p.length>0&&(p=this._utils.clearTextFromNumbers(p));var _="";"SELECT"===t.nodeName&&(_=this._utils.getDropDownListValues(t).join(";"));var g=t.value||t.innerHTML||"";g=g.length>this._maxElemValLength?"":this._utils.maskText(g);var v=this._utils.isUndefinedNull(t.checked)?-1:t.checked?1:0,m=this.getEventTimestamp();return this._dataQueue.addToQueue("elements",e.CDUtils.convertToArrayByMap(e.DataMappingDefs.ELEMENT_MAP,{elementHash:i,tagName:f||"",id:c||"",name:l||"",type:t.type||"",leftPosition:r||0,topPosition:a||0,width:o||0,height:u||0,className:h||"",href:p||"",title:d||"",alt:t.alt||"",selectValues:_||"",elementValue:g||"",checked:v,timestamp:m})),log.isDebug()&&log.debug("adding element id:"+c+", name:"+l+", type:"+t.type+", width:"+o+", height:"+u+", left:"+r+", top:"+a+", hash: "+i),this.handlerEpilog("t.E_get"),i},t.prototype.isListed=function(e){return this._elementHashWMap.has(e)},t.prototype.isReady=function(){return this._isReady},t.prototype.verifyNoPrivateData=function(e){return/\d\d\d/.test(e)?this._utils.clearTextFromNumbers(e):e},t.prototype.updateFeatureConfig=function(){this._collectPosition="boolean"==typeof this._configMgr.get("isElementsPosition")?this._configMgr.get("isElementsPosition"):this._collectPosition,this._collectClassName="boolean"==typeof this._configMgr.get("isElementsClassName")?this._configMgr.get("isElementsClassName"):this._collectClassName,this._collectTitle="boolean"==typeof this._configMgr.get("isElementsTitle")?this._configMgr.get("isElementsTitle"):this._collectTitle,this._collectHref="boolean"==typeof this._configMgr.get("isElementsHref")?this._configMgr.get("isElementsHref"):this._collectHref,this._maxElemValLength=this._configMgr.get("maxElValLen")?this._configMgr.get("maxElValLen"):this._maxElemValLength},e.Elements=t}(i),function(e){function t(t,n,i,s,r){var a=this;this._configMgr=t,this._utils=n,this._elements=i,this._dataQueue=s,this._perfMonitor=r,this._isReady=!1;var o,u=function(e){return n.dateNow()},c=a._utils.StorageUtils,l=e.EnumDefs.Events.mouseEventType,h=e.EnumDefs.Events.isTrusted;this.getMouseEvent=function(e){var t=e.which;"mouseup"===e.type?o=t:"click"===e.type&&0===t&&(t=o);var n=l[e.type];a._utils.isUndefinedNull(n)&&(n=-1);var i=e.deltaY||e.deltaX||e.deltaZ||e.wheelDelta||0;a._dataQueue.addToQueue("mouse_events",[null,c.getAndUpdateEventSequenceNumber(),u(),n,h[e.isTrusted],"mousemove"===e.type?0:a._elements.getElement(e.target),e.pageX?Math.round(e.pageX):-1,e.pageY?Math.round(e.pageY):-1,e.screenX?Math.round(e.screenX):-1,e.screenY?Math.round(e.screenY):-1,null===t||t===undefined?-1:t,Math.round(i),e.clientX?Math.round(e.clientX):-1,e.clientY?Math.round(e.clientY):-1,e.detail||0,null===e.button||e.button===undefined?-1:e.button])}}(t.prototype=Object.create(e.Events.prototype)).startFeature=function(t){var n=this;try{log.trace("MouseEvents:startFeature"),this._perfMonitor.stopMonitor("t.timeTillDataCollect"),t||(t=window.self);var i=t.document||t.contentDocument;this._utils.addEventListener(i,"mousemove",this.getMouseEvent,!0),this._utils.addEventListener(i,"mousedown",this.getMouseEvent,!0),this._utils.addEventListener(i,"mouseup",this.getMouseEvent,!0),this._utils.addEventListener(i,"click",this.getMouseEvent,!0),this._utils.addEventListener(i,"dblclick",this.getMouseEvent,!0),this._isIE=!!document.documentMode||/edge/.test(window.navigator.userAgent.toLowerCase()),this._isIE?e.CDUtils.DomUtils.onDocumentBody(t,function(){n._utils.addEventListener(i.body,"mouseleave",n.getMouseEvent),n._utils.addEventListener(i.body,"mouseenter",n.getMouseEvent)}):(this._utils.addEventListener(i,"mouseleave",this.getMouseEvent),this._utils.addEventListener(i,"mouseenter",this.getMouseEvent)),this._utils.addEventListener(i,"wheel",this.getMouseEvent,!0),this._isReady=!0}catch(s){log.error("MouseEvents:startFeature failed. msg:"+s.message,s)}},t.prototype.stopFeature=function(e){try{log.trace("MouseEvents:stopFeature"),e||(e=window.self);var t=e.document||e.contentDocument;this._utils.removeEventListener(t,"mousemove",this.getMouseEvent,!0),this._utils.removeEventListener(t,"mousedown",this.getMouseEvent,!0),this._utils.removeEventListener(t,"mouseup",this.getMouseEvent,!0),this._utils.removeEventListener(t,"click",this.getMouseEvent,!0),this._utils.removeEventListener(t,"dblclick",this.getMouseEvent,!0),this._isIE?(this._utils.removeEventListener(t.body,"mouseleave",this.getMouseEvent),this._utils.removeEventListener(t.body,"mouseenter",this.getMouseEvent)):(this._utils.removeEventListener(t,"mouseleave",this.getMouseEvent),this._utils.removeEventListener(t,"mouseenter",this.getMouseEvent)),this._utils.removeEventListener(t,"wheel",this.getMouseEvent,!0)}catch(n){log.error("MouseEvents:stopFeature failed. msg:"+n.message,n)}this._isReady=!1},t.prototype.isReady=function(){return this._isReady},e.MouseEvents=t}(i),function(i){var s=function(s){function a(t,i,s,r,o,u){n(this,a);var c=e(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,o));return c._configManager=t,c._utils=i,c._dataQ=r,c._elements=s,c._msgBus=u,c._isReady=!1,c._onAllBrowsersTouchEventBinded=c._onAllBrowsersTouchEvent.bind(c),c}return t(a,i.Events),r(a,[{key:"startFeature",value:function(e){log.trace("TouchEvents:startFeature"),e||(e=window.self),this._bind(e),this._isReady=!0}},{key:"stopFeature",value:function(e){log.trace("TouchEvents:stopFeature"),e||(e=window.self),this._unbind(e),this._isReady=!1}},{key:"isReady",value:function(){return this._isReady}},{key:"_addToCommunicationQueue",value:function(e,t,n,s){e!==i.EnumDefs.Events.touchEventType.touchstart&&e!==i.EnumDefs.Events.touchEventType.touchend||this._msgBus.publish(i.EnumDefs.MessageBusTypes.TouchEvent,{action:e});var r=this.getEventTimestamp(s),a=i.EnumDefs.Events.isTrusted[s.isTrusted],o=this._elements.getElement(s.target),u=this._utils.StorageUtils.getAndUpdateEventSequenceNumber();this._utils.isUndefinedNull(e)&&(e=-1),this._utils.isUndefinedNull(t)&&(t=-1),this._dataQ.addToQueue("touch_events",i.CDUtils.convertToArrayByMap(i.DataMappingDefs.TOUCH_EVENT_MAP,{eventSequence:u,relativeTime:r,eventType:e,isTrusted:a,elementHash:o,clientX:n.clientX?Math.round(n.clientX):0,clientY:n.clientY?Math.round(n.clientY):0,touchIndex:t,touchSizeMajor:n.radiusX?2*n.radiusX:0,touchSizeMinor:n.radiusY?2*n.radiusY:0,pageX:n.pageX||0,pageY:n.pageY||0,screenX:n.screenX||0,screenY:n.screenY||0}))}},{key:"_bind",value:function(e){log.trace("TouchEvents:_bind");var t=e.document||e.contentDocument,n=void 0;if(window.TouchEvent?n=["touchstart","touchmove","touchend","touchcancel"]:window.PointerEvent&&(n=["pointerdown","pointermove","pointerup"]),this._listeningToEvents=n,this._listeningToEvents)for(var i=0;i<this._listeningToEvents.length;i++)this._utils.addEventListener(t,this._listeningToEvents[i],this._onAllBrowsersTouchEventBinded)}},{key:"_unbind",value:function(e){log.trace("TouchEvents:_unbind");var t=e.document||e.contentDocument;if(this._listeningToEvents)for(var n=0;n<this._listeningToEvents.length;n++)this._utils.removeEventListener(t,this._listeningToEvents[n],this._onAllBrowsersTouchEventBinded)}},{key:"_onAllBrowsersTouchEvent",value:function(e){return this.handlerProlog("t.TE"),this._onIeTouchEvent(e),this._onTouchEvent(e),this.handlerEpilog("t.TE"),!0}},{key:"_onTouchEvent",value:function(e){if((null===e.pointerType||e.pointerType===undefined)&&e.changedTouches!==undefined)for(var t=i.EnumDefs.Events.touchEventType[e.type],n=0;n<e.changedTouches.length;n++){var s=e.changedTouches[n],r=s.identifier%1e4;this._addToCommunicationQueue(t,r,s,e)}}},{key:"_onIeTouchEvent",value:function(e){if(null!=e.pointerType&&("touch"===e.pointerType||"pen"===e.pointerType||e.pointerType===e.MSPOINTER_TYPE_TOUCH||e.pointerType===e.MSPOINTER_TYPE_PEN)){var t=i.EnumDefs.Events.touchEventIEType[e.type]||"touchcancel",n=e.pointerId?e.pointerId%1e4:0,s=i.EnumDefs.Events.touchEventType[t];this._addToCommunicationQueue(s,n,e,e)}}}]),a}();i.TouchEvents=s}(i),function(i){var s=20,a=500,o=function(o){function u(t,i,r,o,c){n(this,u);var l=e(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,c));return l._configManager=t,l._utils=i,l._dataQ=o,l._elements=r,l._activeTouchActions={},l._tapMaxSlop=l._configManager.get("tapEventsTapMaxSlop")||s,l._longPressTimeout=l._configManager.get("tapEventsLongPressTimeout")||a,l._handleStartEventBind=l._handleStartEvent.bind(l),l._handleMoveEventBind=l._handleMoveEvent.bind(l),l._handleEndEventBind=l._handleEndEvent.bind(l),l._handleCancelEventBind=l._handleCancelEvent.bind(l),l._eventDefinitions=u.getSupportedTouchEvents(),l}return t(u,i.Events),r(u,[{key:"startFeature",value:function(e){log.trace("TapEvents:startFeature"),e||(e=window.self),this._bind(e)}},{key:"stopFeature",value:function(e){log.trace("TapEvents:stopFeature"),e||(e=window.self),this._unbind(e)}},{key:"updateFeatureConfig",value:function(){log.trace("TapEvents:updateFeatureConfig"),this._tapMaxSlop=this._configManager.get("tapEventsTapMaxSlop")!==undefined?this._configManager.get("tapEventsTapMaxSlop"):this._tapMaxSlop,this._longPressTimeout=this._configManager.get("tapEventsLongPressTimeout")!==undefined?this._configManager.get("tapEventsLongPressTimeout"):this._longPressTimeout}},{key:"_bind",value:function(e){if(log.trace("TapEvents:_bind"),this._eventDefinitions){var t=e.document||e.contentDocument;this._utils.addEventListener(t,this._eventDefinitions.startEvent,this._handleStartEventBind),this._utils.addEventListener(t,this._eventDefinitions.moveEvent,this._handleMoveEventBind),this._utils.addEventListener(t,this._eventDefinitions.endEvent,this._handleEndEventBind),this._utils.addEventListener(t,this._eventDefinitions.cancelEvent,this._handleCancelEventBind)}else log.debug("TapEvents:_bind - No event definitions. Might be a legacy browser. Aborting bind operation.")}},{key:"_unbind",value:function(e){if(log.trace("TapEvents:_unbind"),this._eventDefinitions){var t=e.document||e.contentDocument;this._utils.removeEventListener(t,this._eventDefinitions.startEvent,this._handleStartEventBind),this._utils.removeEventListener(t,this._eventDefinitions.moveEvent,this._handleMoveEventBind),this._utils.removeEventListener(t,this._eventDefinitions.endEvent,this._handleEndEventBind),this._utils.removeEventListener(t,this._eventDefinitions.cancelEvent,this._handleCancelEventBind)}}},{key:"_handleStartEvent",value:function(e){log.trace("TapEvents:_handleStartEvent"),this.handlerProlog("t.TapStartE");for(var t=this._getEventData(e),n=0;n<t.length;n++)this._activeTouchActions[t[n].identifier]={startTime:this.getEventTimestamp(),startX:t[n].touchData.pageX,startY:t[n].touchData.pageY,offsetX:0,offsetY:0};this.handlerEpilog("t.TapStartE")}},{key:"_handleMoveEvent",value:function(e){log.trace("TapEvents:_handleMoveEvent"),this.handlerProlog("t.TapMoveE");for(var t=this._getEventData(e),n=0;n<t.length;n++){var i=this._activeTouchActions[t[n].identifier];i.offsetX=Math.abs(t[n].touchData.pageX-i.startX),i.offsetY=Math.abs(t[n].touchData.pageY-i.startY)}this.handlerEpilog("t.TapMoveE")}},{key:"_handleEndEvent",value:function(e){log.trace("TapEvents:_handleEndEvent"),this.handlerProlog("t.TapEndE");for(var t=this._getEventData(e),n=0;n<t.length;n++){var s=this._activeTouchActions[t[n].identifier];s.offsetX<this._tapMaxSlop&&s.offsetY<this._tapMaxSlop&&(this.getEventTimestamp()-s.startTime<this._longPressTimeout?this._sendEvent("tap_events",i.DataMappingDefs.TAP_EVENT_MAP,t[n].identifier,t[n].touchData,t[n].eventArgs):this._sendEvent("longpress_events",i.DataMappingDefs.LONGPRESS_EVENT_MAP,t[n].identifier,t[n].touchData,t[n].eventArgs)),delete this._activeTouchActions[t[n].identifier]}this.handlerEpilog("t.TapEndE")}},{key:"_handleCancelEvent",value:function(e){log.trace("TapEvents:_handleCancelEvent"),this.handlerProlog("t.TapCancelE");for(var t=this._getEventData(e),n=0;n<t.length;n++)delete this._activeTouchActions[t[n].identifier];this.handlerEpilog("t.TapCancelE")}},{key:"_getEventData",value:function(e){if(e.changedTouches!=undefined){for(var t=[],n=0;n<e.changedTouches.length;n++){var i=e.changedTouches[n],s=i.identifier;t.push({identifier:s,touchData:i,eventArgs:e})}return t}return null==e.pointerType||"touch"!=e.pointerType&&"pen"!=e.pointerType&&e.pointerType!=e.MSPOINTER_TYPE_TOUCH&&e.pointerType!=e.MSPOINTER_TYPE_PEN?[]:[{identifier:e.pointerId?e.pointerId:0,touchData:e,eventArgs:e}]}},{key:"_sendEvent",value:function(e,t,n,s,r){var a=this.getEventTimestamp(),o=i.EnumDefs.Events.isTrusted[r.isTrusted],u=this._elements.getElement(r.target),c=this._utils.StorageUtils.getAndUpdateEventSequenceNumber();this._utils.isUndefinedNull(n)&&(n=0),this._dataQ.addToQueue(e,i.CDUtils.convertToArrayByMap(t,{eventSequence:c,relativeTime:a,screenX:s.screenX?Math.round(s.screenX):0,screenY:s.screenY?Math.round(s.screenY):0,pageX:s.pageX||0,pageY:s.pageY||0,clientX:s.clientX||0,clientY:s.clientY||0,isTrusted:o,elementHash:u,touchIndex:n%1e4,touchSizeMajor:s.radiusX?2*s.radiusX:0,touchSizeMinor:s.radiusY?2*s.radiusY:0}))}}],[{key:"getSupportedTouchEvents",value:function(){return window.TouchEvent?{startEvent:"touchstart",moveEvent:"touchmove",endEvent:"touchend",cancelEvent:"touchcancel"}:window.PointerEvent?{startEvent:"pointerdown",moveEvent:"pointermove",endEvent:"pointerup",cancelEvent:"pointercancel"}:void log.debug("TapEvents:_createEventsToListenList - No touch support for browser.")}}]),u}();i.TapEvents=o}(i),function(e){function t(t,n,i,s,r){var a=this;this._configMgr=t,this._utils=n,this._elements=i,this._dataQueue=s,this._perfMonitor=r,this._isReady=!1,this.comboCode=[67,86,65,88,90,80,83],this.maskKeyAndCode=function(e,t){if(!t.code||e.shiftKey&&"keypress"===e.type){if(1===t.key.length){var n=a._utils.getMapCode(t.key.charCodeAt(0));t.key=String.fromCharCode(n)}}else-1!==t.code.indexOf("Numpad")?(t.code="Numpad",t.key="1"):-1!==t.code.indexOf("Digit")?(t.code="Digit",t.key="1"):-1!==t.code.indexOf("Key")&&(t.code="Key",t.key="A")},this.onKeyEvent=function(t){a.handlerProlog("t.KE");var n=-1;n="keypress"!==t.type&&t.which>95?t.which<106?96:t.which||t.keyCode:a._utils.getMapCode(t.which||t.keyCode),a._utils.isUndefinedNull(n)&&(n=-1);var i=e.EnumDefs.Events.isTrusted[t.isTrusted],s=a.getEventTimestamp(t),r=-1===n||"keypress"!==t.type?"":String.fromCharCode(n),o=a._elements.getElement(t.target),u=e.EnumDefs.Events.keyEventType[t.type];a._utils.isUndefinedNull(u)&&(u=-1);var c=t.ctrlKey&&"keyup"!==t.type||t.metaKey?a.comboCode.indexOf(t.which):-1,l="Meta"===t.key||"OS"===t.key||"Win"===t.key||t.metaKey||91===t.keyCode||92===t.keyCode,h=a._utils.StorageUtils.getAndUpdateEventSequenceNumber(),d={key:t.key||"",code:t.code||""};a.maskKeyAndCode(t,d),log.isDebug()&&log.trace("onKeyEvent: got event: "+u+", at time:"+s+", key: "+d.key+", code:"+d.code+", old charCode:"+n),a._dataQueue.addToQueue("key_events",e.CDUtils.convertToArrayByMap(e.DataMappingDefs.KEY_EVENT_MAP,{eventType:u,eventSequence:h,relativeTime:s,charCode:n,character:r||"",elementHash:o,keyComboType:c,isTrusted:i,isCtrl:t.ctrlKey||!1,isShift:t.shiftKey||!1,isAlt:t.altKey||!1,isMetaKey:l||!1,keyLocation:t.location||0,code:d.code||"",key:d.key||"",location:t.location||"",isRepeat:t.repeat||!1})),a.handlerEpilog("t.KE")}}(t.prototype=Object.create(e.Events.prototype)).startFeature=function(e){try{e||(e=window.self);var t=e.document||e.contentDocument;t.addEventListener("keyup",this.onKeyEvent),t.addEventListener("keydown",this.onKeyEvent),t.addEventListener("keypress",this.onKeyEvent),this._isReady=!0}catch(n){log.error("KeyEvents:startFeature failed, msg: "+n.message,n)}},t.prototype.stopFeature=function(e){try{e||(e=window.self);var t=e.document||e.contentDocument;t.removeEventListener("keyup",this.onKeyEvent),t.removeEventListener("keydown",this.onKeyEvent),t.removeEventListener("keypress",this.onKeyEvent),this._isReady=!1}catch(n){log.error("KeyEvents:stopFeature failed, msg: "+n.message,n)}},t.prototype.isReady=function(){return this._isReady},e.KeyEvents=t}(i),function(i){var s=function(s){function a(t,i,s,r,o,u,c){n(this,a);var l=e(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,u));return Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector),l._configMgr=t,l._utils=i,l._elements=s,l._mutationObserver=r,l._dataQueue=o,l._jQueryElementsListenerSiteMapper=c,l._listenOnInputElementsSelector="input:not([type='color']):not([type='hidden']):not([type='file']):not([type='image']):not([type='button']):not([type='radio']):not([type='checkbox']), textarea",l._listenOnClickElementsSelector="input[type='button'], input[type='radio'], input[type='checkbox'], button",l._listenOnChangeElementsSelector="select",l._listenOnFormsSelector="form",l._elementBindingWMap=new WeakMap,l._maxElemValLength=200,l._inputEventToListenerArray=[{event:"input",listener:l._onInputChangeEvent.bind(l)},{event:"focus",listener:l._onFocusBlurChange.bind(l)},{event:"blur",listener:l._onFocusBlurChange.bind(l)}],l._clickEventToListenerArray=[{event:"click",listener:l._onClickEvent.bind(l)}],l._changeEventToListenerArray=[{event:"change",listener:l._onChangeEvent.bind(l)}],l._formEventToListenerArray=[{event:"submit",listener:l._onFormSubmitEvent.bind(l)}],l._jQueryElementsListenerSiteMapper.updateObserver(l._onSiteMapperMatch.bind(l)),l}return t(a,i.Events),r(a,[{key:"startFeature",value:function(e){log.trace("ElementEvents:startFeature"),e||(e=window.self),this._addOnLoadInputData(e),this._bind(e),this._configMgr.get("isMutationObserver")&&this._mutationObserver&&(this._observeChange(e),this._jQueryElementsListenerSiteMapper.initTracking())}},{key:"updateFeatureConfig",value:function(e){log.trace("ElementEvents:updateFeatureConfig"),this._configMgr.get("isMutationObserver")&&this._mutationObserver&&(this._observeChange(e),this._jQueryElementsListenerSiteMapper.onConfigUpdate(this._configMgr)),this._elements.updateFeatureConfig()}},{key:"stopFeature",value:function(e){log.trace("ElementEvents:stopFeature"),this._unbind(e),this._observer&&this._observer.disconnect(),this._jQueryElementsListenerSiteMapper.stopTracking(),this._observer=null}},{key:"_onFocusBlurChange",value:function(e){log.trace("ElementEvents:_onFocusBlurChange"),this.handlerProlog("t.EE_FocusBlurChange"),this._commonEventHandling(e,{length:0,selected:-1,elementValues:""}),this.handlerEpilog("t.EE_FocusBlurChange")}},{key:"_onInputChangeEvent",value:function(e){log.trace("ElementEvents:_onInputChangeEvent"),this.handlerProlog("t.EE_InputChange");var t=e.target.value||"";""!==t&&(t=this._utils.maskText(t)),this._commonEventHandling(e,{length:t?t.length:0,elementValues:t,selected:-1}),this.handlerEpilog("t.EE_InputChange")}},{key:"_onClickEvent",value:function(e){log.trace("ElementEvents:_onClickEvent"),this.handlerProlog("t.EE_Click");var t=e.target,n=t.value||t.innerHTML;this._utils.clearTextFromNumbers(n),this._commonEventHandling(e,{length:n.length,elementValues:n,selected:t.checked===undefined?-1:t.checked?1:0}),this.handlerEpilog("t.EE_Click")}},{key:"_onChangeEvent",value:function(e){log.trace("ElementEvents:_onChangeEvent"),this.handlerProlog("t.EE_Change");var t=this._utils.getDropDownListValues(e.target).join(";");t=this._utils.clearTextFromNumbers(t);var n=e.target.selectedIndex,i=e.target.value.length;this._commonEventHandling(e,{length:i,selected:n,elementValues:t}),this.handlerEpilog("t.EE_Change")}},{key:"_observeChange",value:function(e){e||(e=window.self);var t=this,n=e.document||e.contentDocument;this._observer=new this._mutationObserver(function(n){log.trace("ElementEvents:_mutationObserver cb");try{for(var i=0;i<n.length;i++)if(n[i].addedNodes.length>0){t._addOnLoadInputData(e),t._bind(e);break}}catch(s){log.error("ElementEvents._observeChange: "+s.message)}}),this._observer.observe(n,{childList:!0,subtree:!0})}},{key:"_addListenersBySelector",value:function(e,t,n){log.trace("ElementEvents:_addListenersBySelector");for(var i=n.querySelectorAll(e),s=0;s<i.length;s++)this._addElementEvents(i[s],t)}},{key:"_addElementEvents",value:function(e,t){var n=arguments.length>2&&arguments[2]!==undefined&&arguments[2];if(!this._elementBindingWMap.get(e)){for(var i=0;i<t.length;i++)if(n){if(!this._utils.JQueryUtils.isJQueryAvailable())return void log.error("Unable to add event listeners for element using jQuery because jQuery is not available");this._utils.JQueryUtils.addEventListener(e,t[i].event,t[i].listener)}else e.addEventListener(t[i].event,t[i].listener);this._elementBindingWMap.set(e,{isBinded:!0,isUsingJQuery:n})}}},{key:"_removeListenersBySelector",value:function(e,t,n){log.trace("ElementEvents:_removeListenersBySelector");for(var i=n.querySelectorAll(e),s=0;s<i.length;s++)this._removeElementEvents(i[s],t)}},{key:"_removeElementEvents",value:function(e,t,n){var i=this._elementBindingWMap.get(e);if(i&&i.isBinded){for(var s=0;s<t.length;s++)if(i.isUsingJQuery){if(!this._utils.JQueryUtils.isJQueryAvailable())return void log.error("Unable to remove event listeners for element using jQuery because jQuery is not available");this._utils.JQueryUtils.removeEventListener(e,t[s].event,t[s].listener)}else e.removeEventListener(t[s].event,t[s].listener);this._elementBindingWMap["delete"](e)}}},{key:"_addOnLoadInputData",value:function(e){log.trace("ElementEvents:_addOnLoadInputData"),this.handlerProlog("t.EE_OnLoad"),e||(e=window.self);for(var t=e.document.querySelectorAll(this._listenOnInputElementsSelector+","+this._listenOnClickElementsSelector+","+this._listenOnChangeElementsSelector),n=0;n<t.length;n++){var i=t[n];this._elements.isListed(i)||this._elements.getElement(i)}this.handlerEpilog("t.EE_OnLoad")}},{key:"_onFormSubmitEvent",value:function(e){log.trace("ElementEvents:_onFormSubmitEvent"),this._commonEventHandling(e,{length:0,selected:-1,elementValues:""})}},{key:"_bindRemoveHelper",value:function(e,t){log.trace("ElementEvents:_bindRemoveHelper");var n=(t=t||window.self).document||t.contentDocument;e(this._listenOnInputElementsSelector,this._inputEventToListenerArray,n),e(this._listenOnClickElementsSelector,this._clickEventToListenerArray,n),e(this._listenOnChangeElementsSelector,this._changeEventToListenerArray,n),e(this._listenOnFormsSelector,this._formEventToListenerArray,n)}},{key:"_bind",value:function(e){this._bindRemoveHelper(this._addListenersBySelector.bind(this),e)}},{key:"_unbind",value:function(e){this._bindRemoveHelper(this._removeListenersBySelector.bind(this),e)}},{key:"_commonEventHandling",value:function(e,t){log.trace("ElementEvents:_commonEventHandling");var n=i.EnumDefs.Events.isTrusted[e.isTrusted],s=this.getEventTimestamp(e),r=i.EnumDefs.Events.elementEventType[e.type];this._utils.isUndefinedNull(r)&&(r=-1);var a=this._elements.getElement(e.target),o=this._utils.StorageUtils.getAndUpdateEventSequenceNumber();(t=t||{}).elementValues&&t.elementValues.length>this._maxElemValLength&&(t.elementValues=""),Object.extend(t,{eventType:r,eventSequence:o,relativeTime:s,elementHash:a,isTrusted:n}),this._dataQueue.addToQueue("element_events",i.CDUtils.convertToArrayByMap(i.DataMappingDefs.ELEMENT_EVENT_MAP,t),!0)}},{key:"_onSiteMapperMatch",value:function(e){var t=e.selector;if(t)try{var n=window.document.querySelector(t);if(!n)return void log.error("ElementEvents._onSiteMapperMatch - selector:"+JSON.stringify(t)+" not found on page");var i=[];if(n.matches(this._listenOnInputElementsSelector))i=this._inputEventToListenerArray;else if(n.matches(this._listenOnClickElementsSelector))i=this._clickEventToListenerArray;else if(n.matches(this._listenOnChangeElementsSelector))i=this._changeEventToListenerArray;else{if(!n.matches(this._listenOnFormsSelector))return void log.error("ElementEvents._onSiteMapperMatch - Unable to match the element with selector:"+JSON.stringify(t)+" to any selectors group. Aborting jQuery element listening process.");i=this._formEventToListenerArray}this._removeElementEvents(n,i),this._addElementEvents(n,i,!0)}catch(s){log.error("ElementEvents._onSiteMapperMatch - "+s.message,s)}else log.warn("ElementEvents._onSiteMapperMatch - No selector defined for match. Aborting jQuery element listening process.")}}]),a}();i.ElementEvents=s}(i),function(e){function t(t,n,i,s,r){var a=this;this._configMgr=t,this._utils=n,this._elements=i,this._dataQueue=s,this._perfMonitor=r,this._isReady=!1,this.onClipboardEvent=function(t){a.handlerProlog("t.CE");try{var n=a.getEventTimestamp(t),i=a._elements.getElement(t.target),s=a._utils.StorageUtils.getAndUpdateEventSequenceNumber(),r=t.clipboardData?t.clipboardData.getData("text"):window.clipboardData?window.clipboardData.getData("text"):"";""!==(r=r||"")&&(r=r.replace(/[\d]/g,"1").replace(/[a-zA-Z]/g,"a").replace(/[^a-zA-Z\d]/g,"*"));var o=e.EnumDefs.Events.clipboardEventType[t.type];a._utils.isUndefinedNull(o)&&(o=-1),a._dataQueue.addToQueue("clipboard_events",e.CDUtils.convertToArrayByMap(e.DataMappingDefs.CLIPBOARD_EVENT_MAP,{eventSequence:s,relativeTime:n,elementHash:i,copiedText:r,clipboardEventType:o}))}catch(u){log.error("ClipBoardEvents:onClipboardEvent failed. msg: "+u.message,u)}a.handlerEpilog("t.CE")}}(t.prototype=Object.create(e.Events.prototype)).startFeature=function(e){try{e||(e=window.self);var t=e.document||e.contentDocument;t.addEventListener("copy",this.onClipboardEvent),t.addEventListener("cut",this.onClipboardEvent),t.addEventListener("paste",this.onClipboardEvent),this._isReady=!0}catch(n){log.error("ClipBoardEvents:startFeature failed. msg: "+n.message,n)}},t.prototype.stopFeature=function(e){try{e||(e=window.self);var t=e.document||e.contentDocument;t.removeEventListener("copy",this.onClipboardEvent),t.removeEventListener("cut",this.onClipboardEvent),t.removeEventListener("paste",this.onClipboardEvent),this._isReady=!1}catch(n){log.error("ClipBoardEvents:stopFeature failed. msg: "+n.message,n)}},t.prototype.isReady=function(){return this._isReady},e.ClipBoardEvents=t}(i),function(i){var s=function(s){function a(t,i,s){n(this,a);var r=e(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,s));return r._onScriptExecuteEventFunc=r._onScriptExecuteEvent.bind(r),r._dataQueue=i,r._utils=t,r}return t(a,i.Events),r(a,[{key:"_onScriptExecuteEvent",value:function(e){if(e&&e.target&&("load"!==e.type||"script"===e.target.nodeName.toLowerCase()))try{this.handlerProlog("t.SE_E");var t=this.getEventTimestamp(e),n=this._utils.StorageUtils.getAndUpdateEventSequenceNumber(),s=i.EnumDefs.Events.scriptEventType[e.type];this._utils.isUndefinedNull(s)&&(s=-1),log.isDebug()&&log.trace("got event "+e.type+", "+s+", scriptSrc: "+e.target.src+" at time "+t),this._dataQueue.addToQueue("script_events",i.CDUtils.convertToArrayByMap(i.DataMappingDefs.SCRIPT_EVENT_MAP,{eventSequence:n,relativeTime:t,eventType:s,scriptId:e.target.id||"",namespaceURI:e.target.namespaceURI||"",outerHTML:e.target.outerHTML||"",scriptSource:e.target.src||"",scriptType:e.target.type||""})),this.handlerEpilog("t.SE_E")}catch(r){this.handlerCancelog("t.SE_E"),log.error("error on getScriptExecuteEvent "+r.toString())}}},{key:"startFeature",value:function(){log.trace("ScriptEvents:startFeature"),this._utils.addEventListener(document,"load",this._onScriptExecuteEventFunc,!0)}},{key:"stopFeature",value:function(){log.trace("ScriptEvents:stopFeature"),this._utils.removeEventListener(document,"load",this._onScriptExecuteEventFunc,!0)}}]),a}();i.ScriptEvents=s}(i),function(e){var t=1e3,i=function(){function i(s,r,a){n(this,i),this._historyBuffer=[],this._isTouchInProgress=!1,this._touchStartCount=0,this._isPostTouch=!1,this._touchEndTime=0,this._dataQueue=r,this._configMgr=s,this._msgBus=a,this._msgBus.subscribe(e.EnumDefs.MessageBusTypes.TouchEvent,this._onTouch.bind(this)),this._isMotionAroundTouchEnabled=this._configMgr.get("isMotionAroundTouchEnabled")===undefined||this._configMgr.get("isMotionAroundTouchEnabled"),this._aroundTouchInterval=this._configMgr.get("motionPaddingAroundTouchMSec")!==undefined?this._configMgr.get("motionPaddingAroundTouchMSec"):t}return r(i,[{key:"addToQueue",value:function(t,n,i,s){log.trace("SensorsDataQueue:addToQueue");var r=e.CDUtils.dateNow();if(this._isPostTouch&&r-this._touchEndTime>this._aroundTouchInterval&&(log.debug("SensorsDataQueue: stopped post touch events, time has passed ("+this._aroundTouchInterval+" millisec)"),this._isPostTouch=!1),!this._isMotionAroundTouchEnabled||this._isTouchInProgress||this._isPostTouch)this._dataQueue.addToQueue(t,n,i,s);else{this._historyBuffer.push({name:t,data:n,addCtxId:i,isImmediateWup:s,timestamp:r});for(var a=0,o=this._historyBuffer.length;a<o&&r-this._historyBuffer[0].timestamp>this._aroundTouchInterval;a++)this._historyBuffer.shift()}}},{key:"onConfigUpdate",value:function(){this._aroundTouchInterval=this._configMgr.get("motionPaddingAroundTouchMSec")!==undefined?this._configMgr.get("motionPaddingAroundTouchMSec"):this._aroundTouchInterval,this._isMotionAroundTouchEnabled=this._configMgr.get("isMotionAroundTouchEnabled")!==undefined?this._configMgr.get("isMotionAroundTouchEnabled"):this._isMotionAroundTouchEnabled}},{key:"_sendBuffer",value:function(){var t=e.CDUtils.dateNow();log.debug("sending history sensors buffer ts="+t);for(var n=0,i=this._historyBuffer.length;n<i;n++)t-this._historyBuffer[n].timestamp<=this._aroundTouchInterval&&this._dataQueue.addToQueue(this._historyBuffer[n].name,this._historyBuffer[n].data,this._historyBuffer[n].addCtxId,this._historyBuffer[n].isImmediateWup);this._historyBuffer=[]}},{key:"_onTouch",value:function(t){return this._isMotionAroundTouchEnabled&&(this._isTouchInProgress||t.action!==e.EnumDefs.Events.touchEventType.touchstart?t.action===e.EnumDefs.Events.touchEventType.touchend?--this._touchStartCount<=0&&(this._isTouchInProgress=!1,this._isPostTouch=!0,this._touchEndTime=e.CDUtils.dateNow(),log.debug("stopped touch event in sensors data q ts="+e.CDUtils.dateNow())):t.action===e.EnumDefs.Events.touchEventType.touchstart&&this._touchStartCount++:(log.debug("Started touch event in sensors data q ts="+e.CDUtils.dateNow()),this._isTouchInProgress=!0,this._touchStartCount=1,this._sendBuffer())),!1}}]),i}();e.SensorsDataQueue=i}(i),function(i){var s=function(s){function a(t,i,s){n(this,a);var r=e(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,i,s));return r._utils=t,r._timeoutValue=1e3,r._getScriptsDataBinded=r._getScriptsData.bind(r),r}return t(a,i.AbstractFeature),r(a,[{key:"_getScriptsData",value:function(){var e=document.scripts;if(e)for(var t=0;t<e.length;t++){var n=e[t].src,i=e[t].text;/\d\d\d/.test(n)&&(n=this._utils.clearTextFromNumbers(n)),this._dataQ.addToQueue("scripts",[null,n,this._utils.getHash(i)])}this._timer=setTimeout(this._getScriptsDataBinded,this._timeoutValue),this._timeoutValue<536870911&&(this._timeoutValue*=4)}},{key:"startFeature",value:function(){log.trace("ScriptsFeature:startFeature"),this.preFeature("scripts"),this._getScriptsData(),this.postFeature("scripts")}},{key:"stopFeature",value:function(){log.trace("ScriptsFeature:stopFeature"),this._timer&&clearTimeout(this._timer)}}]),a}();i.ScriptsFeature=s}(i),function(i){var s=function(s){function a(t,i,s,r){n(this,a);var o=e(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,i,s));return o._confMgr=t,o._metaDataSiteMapper=r,o._metaDataSiteMapper.updateObserver(o.onSiteMapperMatch.bind(o)),o}return t(a,i.AbstractFeature),r(a,[{key:"startFeature",value:function(){this._metaDataSiteMapper.initTracking()}},{key:"stopFeature",value:function(){this._metaDataSiteMapper.stopTracking()}},{key:"onSiteMapperMatch",value:function(e){log.info("MetadataCollector:onSiteMapperMatch - "+JSON.stringify(e)),e.metaVal&&this._dataQ.addToQueue("metadata_map",[null,e.metaVal,i.CDUtils.dateNow()])}},{key:"updateFeatureConfig",value:function(){this._metaDataSiteMapper.onConfigUpdate(this._confMgr)}}]),a}();i.MetadataCollector=s}(i),function(e){var t=function(){function t(i,s){n(this,t),this._framesCache=i,this._framesDetector=s,this._framesDetector.frameAdded.subscribe(this._onFrameAdded.bind(this)),this._framesDetector.frameRemoved.subscribe(this._onFrameRemoved.bind(this)),this._framesDetector.frameInaccessible.subscribe(this._onFrameInaccessible.bind(this)),this._featuresMap=new e.Map,this._framesDetector.addToIgnoreList(e.EnumDefs.SystemFrameName.rtcframe),this._framesDetector.addToIgnoreList(e.EnumDefs.SystemFrameName.fontDetectionFrame),this._framesDetector.start(window.self),this._buildFramesCache()}return r(t,[{key:"startFeatures",value:function(e){try{if(this._buildFeaturesMap(e),0===this._featuresMap.size)return;log.debug("startFeatures:Running features on "+this._framesCache.count+" frames"),this._startFeaturesOnFrames(this._framesCache.frames,e)}catch(t){log.debug("Failed to start features in FrameHandler.startFeatures: "+t.message,t)}}},{key:"startFeature",value:function(e){try{this._featuresMap.set(e.configKey,e),e.isRunning=!0,this._startFeaturesOnFrames(this._framesCache.frames,[e])}catch(t){log.debug("Failed to start feature in FrameHandler.startFeature: "+t.message,t)}}},{key:"stopFeatures",value:function(e){try{this._stopFeaturesOnFrames(e,this._framesCache.frames)}catch(t){log.debug("Failed to stop features in FrameHandler.stopFeatures: "+t.message,t)}}},{key:"stopFeature",value:function(e){try{e.isRunning=!1,this._stopFeaturesOnFrames([e],this._framesCache.frames)}catch(t){log.debug("Failed to stop feature in FrameHandler.stopFeature: "+t.message,t)}}},{key:"updateFeatureConfig",value:function(e){e.instance.updateFeatureConfig&&(e.instance.updateFeatureConfig.cdCallAsync(e.instance,window.self),this._updateFeaturesConfigOnFrames([e]))}},{key:"_onFrameAdded",value:function(e){try{log.info("FramesHandler._onFrameAdded - Frame:"+e.name+", id:"+e.id+". was loaded."),this._framesCache.exists(e)?this._framesCache.unRegisterFrameFeatures(e,this._featuresMap.values()):this._framesCache.add(e),this._startFeaturesOnFrames([e],this._featuresMap.values())}catch(t){log.debug("FramesHandler._onFrameAdded - Failed to start features on frame "+e.id+": "+t.message,t)}}},{key:"_onFrameRemoved",value:function(e){try{log.info("FramesHandler._onFrameRemoved - Frame:"+e.name+", id:"+e.id+". was removed."),this._stopFeaturesOnFrames(this._featuresMap.values(),[e])}catch(t){log.debug("FramesHandler._onFrameRemoved - Failed to stop features on frame "+e.id+": "+t.message,t)}}},{key:"_onFrameInaccessible",value:function(e){log.debug("FramesHandler._onFrameInaccessible - Frame:"+e.name+", id:"+e.id+". was detected as inaccessible.")}},{key:"_buildFeaturesMap",value:function(e){var t=this;this._featuresMap.clear(),e.forEach(function(e){t._featuresMap.set(e.configKey,e)})}},{key:"_buildFramesCache",value:function(){var e=this;this._framesDetector.frames.forEach(function(t){e._framesCache.exists(t)||e._framesCache.add(t)})}},{key:"_startFeaturesOnFrames",value:function(t,n){var i=this;log.info("FramesHandler._startFeaturesOnFrames - running features on frames"),t.forEach(function(t){try{var s=!0,r=!1,a=undefined;try{for(var o,u=n[Symbol.iterator]();!(s=(o=u.next()).done);s=!0)!function(n){n.shouldRun&&!i._framesCache.hasFeature(t,n)&&(i._framesCache.registerFrameFeature(t,n),e.CDUtils.DomUtils.isWindowDocumentReady(t.contentWindow)&&(log.debug("_startFeaturesOnFrames: run feature on frame:"+t.name+", id:"+t.id+". feature:"+n.configKey),n.instance.startFeature.cdCallAsyncWithErrorHandling(n.instance,function(e){log.error("An error has occurred while starting feature "+n.configKey+" on frame "+t.name+" with id: "+t.id+". Error: "+e.message,e)},t.contentWindow),n.isRunning=!0))}(o.value)}catch(c){r=!0,a=c}finally{try{!s&&u["return"]&&u["return"]()}finally{if(r)throw a}}}catch(l){log.error("An error has occurred while starting features on frame "+t.name+" with id: "+t.id+". Error: "+l.message,l)}})}},{key:"_featuresOnFramesHelper",value:function(e,t,n,i,s){var r=this;t.forEach(function(t){try{if(t.contentWindow&&t.contentWindow.document&&r._framesCache.exists(t))for(var a=0,o=e.length;a<o;a++)r._framesCache.hasFeature(t,e[a])&&e[a].instance[n].cdCallAsync(e[a].instance,t.contentWindow),i&&(e[a][i]=s)}catch(u){}})}},{key:"_stopFeaturesOnFrames",value:function(e,t){var n=this;try{this._featuresOnFramesHelper(e,t,"stopFeature","isRunning",!1),this._framesCache.frames.forEach(function(t){n._framesCache.exists(t)&&n._framesCache.unRegisterFrameFeatures(t,e),n._framesCache.remove(t)})}catch(i){log.debug("FramesHandler._stopFeaturesOnFrames stopping features on frames "+i.message,i)}}},{key:"_updateFeaturesConfigOnFrames",value:function(e){try{this._featuresOnFramesHelper(e,this._framesCache.frames,"updateFeatureConfig")}catch(t){log.error("FramesHandler._updateFeaturesOnFrames updating features on frames "+t.message,t)}}}]),t}();e.FramesHandler=t}(i),function(e){var t=function(){function t(){n(this,t),this._frames=new e.Map}return r(t,[{key:"add",value:function(t){this._frames.set(t,{registered:!0,features:new e.Map})}},{key:"remove",value:function(e){this.exists(e)&&0===this._frames.get(e).features.size&&this._frames["delete"](e)}},{key:"get",value:function(e){return this._frames.get(e)}},{key:"exists",value:function(e){return this._frames.has(e)&&this._frames.get(e).registered}},{key:"registerFrameFeature",value:function(e,t){this.exists(e)&&this._frames.get(e).features.set(t.configKey,!0)}},{key:"unRegisterFrameFeature",value:function(e,t){this.exists(e,t)&&this._frames.get(e).features["delete"](t.configKey)}},{key:"unRegisterFrameFeatures",value:function(e,t){var n=!0,i=!1,s=undefined;try{for(var r,a=t[Symbol.iterator]();!(n=(r=a.next()).done);n=!0){var o=r.value;this.unRegisterFrameFeature(e,o)}}catch(u){i=!0,s=u}finally{try{!n&&a["return"]&&a["return"]()}finally{if(i)throw s}}}},{key:"hasFeature",value:function(e,t){return this.exists(e)&&this._frames.get(e).features.has(t.configKey)}},{key:"frames",get:function(){var e=[];return this._frames.forEach(function(t,n){e.push(n)}),e}},{key:"count",get:function(){return this._frames.size}}]),t}();e.FramesCache=t}(i),function(e){var t=function(){function t(i,s){n(this,t),this._mutationObserverFactory=i,this._cdUtils=s,this._windowMutationObservers=new e.Map,this._loadedFrames=new e.Map,this._framesToIgnore=new e.Set,this._frameSelector="frame, iframe",this._frameLoadedCallback=this._onFrameLoad.bind(this),this.frameAdded=new e.CDEvent,this.frameRemoved=new e.CDEvent,this.frameInaccessible=new e.CDEvent}return r(t,[{key:"start",value:function(e){var t=this;this._monitorWindow(e),this._findFrames(e.document).forEach(function(e){t._processNewFrame(e)})}},{key:"stop",value:function(){this._windowMutationObservers.forEach(function(e){e.disconnect()}),this._windowMutationObservers.clear(),this._loadedFrames.clear(),this._framesToIgnore.clear()}},{key:"addToIgnoreList",value:function(e){this._framesToIgnore.add(e)}},{key:"_monitorWindow",value:function(e){if(!this._windowMutationObservers.has(e)){var t=new this._mutationObserverFactory(this._mutationObserved.bind(this));t.observe(e.document,{childList:!0,subtree:!0}),this._windowMutationObservers.set(e,t)}}},{key:"_unMonitorWindow",value:function(e){var t=this._windowMutationObservers.get(e);t&&t.disconnect(),this._windowMutationObservers["delete"](e)}},{key:"_mutationObserved",value:function(e){var t=this;e.forEach(function(e){t._processMutation(e)})}},{key:"_processMutation",value:function(e){this._processAddedNodes(e.addedNodes),this._processRemovedNodes(e.removedNodes)}},{key:"_processAddedNodes",value:function(e){for(var t=this,n=0;n<e.length;n++){var i=e[n];if(i.matches&&i.matches(this._frameSelector))this._processNewFrame(i);else{if(!i.hasChildNodes())continue;this._findFrames(i).forEach(function(e){t._processNewFrame(e)})}}}},{key:"_processNewFrame",value:function(e){this._framesToIgnore.has(e.id)||this._loadedFrames.has(e)||(this._cdUtils.addEventListener(e,"load",this._frameLoadedCallback),this._cdUtils.DomUtils.canAccessIFrame(e)?this._cdUtils.DomUtils.isWindowDocumentReady(e.contentWindow)&&this._addFrame(e):this.frameInaccessible.publish(e))}},{key:"_addFrame",value:function(e){var t=this;this._monitorWindow(e.contentWindow),this._findFrames(e.contentWindow.document).forEach(function(e){t._processNewFrame(e)}),this._loadedFrames.set(e,e.contentDocument),this.frameAdded.publish(e)}},{key:"_processRemovedNodes",value:function(e){for(var t=this,n=0;n<e.length;n++){var i=e[n];if(i.matches&&i.matches(this._frameSelector))this._removeFrame(i);else{if(!i.hasChildNodes())continue;this._findFrames(i).forEach(function(e){t._removeFrame(e)})}}}},{key:"_removeFrame",value:function(e){this._unMonitorWindow(e.contentWindow),this._cdUtils.removeEventListener(e,"load",this._frameLoadedCallback),this._loadedFrames["delete"](e)&&this.frameRemoved.publish(e)}},{key:"_onFrameLoad",value:function(e){var t=e.target;this._loadedFrames.has(t)&&this._removeFrame(t),this._processNewFrame(t)}},{key:"_findFrames",value:function(e){for(var t=[],n=[],i=e.querySelectorAll(this._frameSelector),s=0;s<i.length;s++)n.push(i[s]);for(var r=0;r<n.length;r++){var a=[],o=n[r];t.push(o),this._cdUtils.DomUtils.canAccessIFrame(o)?(a=this._findFrames(o.contentWindow.document)).length>0&&(t=t.concat(a)):this.frameInaccessible.publish(o)}return t}},{key:"frames",get:function(){var e=[];return this._loadedFrames.forEach(function(t,n){e.push(n)}),e}}]),t}();e.FramesDetector=t}(i),function(e){e.FeaturesList={defaultFeatures:{ElementEvents:{configKey:"isElementsEvent",shouldRun:!0,isFrameRelated:!0,runInUns:!1,runInSlave:!0,isRunning:!1,init:function(){var t=new e.SiteMapper(MutationObserver,this._utils,this._perfMonitor,"jQueryElementListenerConfig",null,!1);this._features.defaultFeatures.ElementEvents.instance=new e.ElementEvents(this._configMgr,this._utils,this._elements,this._mutationObserver,this._dataQ,this._perfMonitor,t)},instance:null},MouseEvents:{configKey:"isMouseEvents",shouldRun:!0,isFrameRelated:!0,runInUns:!1,runInSlave:!0,isRunning:!1,init:function(){this._features.defaultFeatures.MouseEvents.instance=new e.MouseEvents(this._configMgr,this._utils,this._elements,this._dataQ,this._perfMonitor)},instance:null},KeyEvents:{configKey:"isKeyEvents",shouldRun:!0,isFrameRelated:!0,runInUns:!1,runInSlave:!0,isRunning:!1,init:function(){this._features.defaultFeatures.KeyEvents.instance=new e.KeyEvents(this._configMgr,this._utils,this._elements,this._dataQ,this._perfMonitor)},instance:null},ClipBoardEvents:{configKey:"isClipboardEvent",shouldRun:!0,isFrameRelated:!0,runInUns:!1,runInSlave:!0,isRunning:!1,init:function(){this._features.defaultFeatures.ClipBoardEvents.instance=new e.ClipBoardEvents(this._configMgr,this._utils,this._elements,this._dataQ,this._perfMonitor)},instance:null},WindowEvents:{configKey:"isWindowEvents",shouldRun:!0,isFrameRelated:!1,runInUns:!1,isRunning:!1,init:function(){this._features.defaultFeatures.WindowEvents.instance=new e.WindowEvents(this._configMgr,this._utils,this._dataQ,this._perfMonitor)},instance:null},TouchEvents:{configKey:"isTouchEvents",shouldRun:!0,isFrameRelated:!0,runInUns:!1,runInSlave:!0,isRunning:!1,init:function(){this._features.defaultFeatures.TouchEvents.instance=new e.TouchEvents(this._configMgr,this._utils,this._elements,this._dataQ,this._perfMonitor,this._msgBus)},instance:null},MetadataCollector:{configKey:"isMetadataCollect",shouldRun:!0,isFrameRelated:!1,runInUns:!1,runInSlave:!0,isRunning:!1,init:function(){var t=new e.SiteMapper(MutationObserver,this._utils,this._perfMonitor,"metadataConfig",null,!1);this._features.defaultFeatures.MetadataCollector.instance=new e.MetadataCollector(this._configMgr,this._dataQ,this._perfMonitor,t)},instance:null},TabsEvents:{configKey:"isTabsEvents",shouldRun:!0,isFrameRelated:!1,runInUns:!1,runInSlave:!1,isRunning:!1,init:function(){this._features.defaultFeatures.TabsEvents.instance=new e.TabsEvents(this._utils,this._dataQ)},instance:null}},perSessionFeatures:{DoNotTrack:{configKey:"isDoNotTrack",shouldRun:!0,isFrameRelated:!1,runInUns:!0,isRunning:!1,init:function(){this._features.perSessionFeatures.DoNotTrack.instance=new e.DoNotTrackFeature(this._dataQ,this._perfMonitor)},instance:null},BrowserProps:{configKey:"collectBrowserProps",shouldRun:!0,isFrameRelated:!1,runInUns:!0,isRunning:!1,init:function(){this._features.perSessionFeatures.BrowserProps.instance=new e.BrowserPropsFeature(this._dataQ,this._perfMonitor,e.PointerHoverDetector,this._utils,this._configMgr)},instance:null},IsPrivateBrowsing:{configKey:"isPrivateBrowsing",shouldRun:!0,isFrameRelated:!1,runInUns:!0,isRunning:!1,init:function(){this._features.perSessionFeatures.IsPrivateBrowsing.instance=new e.IsPrivateBrowsingFeature(this._dataQ,this._perfMonitor,new e.PrivateBrowsingDetector)},instance:null},IpDetectorFeature:{configKey:"isIpCollection",shouldRun:!0,isFrameRelated:!1,isRunning:!1,init:function(){this._features.perSessionFeatures.IpDetectorFeature.instance=new e.IpDetectorFeature(this._dataQ,this._perfMonitor,this._configMgr)},instance:null},FontsDetectionFeature:{configKey:"isFonts",shouldRun:!0,isFrameRelated:!1,runInUns:!0,isRunning:!1,init:function(){this._features.perSessionFeatures.FontsDetectionFeature.instance=new e.FontsDetectionFeature(this._utils,this._dataQ,this._perfMonitor,e.FontsDetector)},instance:null},GraphicDetectFeature:{configKey:"isVMDetection",shouldRun:!0,isFrameRelated:!1,runInUns:!1,isRunning:!1,init:function(){this._features.perSessionFeatures.GraphicDetectFeature.instance=new e.GraphicDetectFeature(this._dataQ,this._perfMonitor)},instance:null},AudioFeature:{configKey:"isAudioDetection",shouldRun:!0,isFrameRelated:!1,runInUns:!1,isRunning:!1,init:function(){this._features.perSessionFeatures.AudioFeature.instance=new e.AudioFeature(this._utils,this._dataQ,this._perfMonitor)},instance:null},BrowserDetect:{configKey:"isBrowserDetect",shouldRun:!0,isFrameRelated:!1,runInUns:!0,isRunning:!1,init:function(){this._features.perSessionFeatures.BrowserDetect.instance=new e.BrowserDetect(this._dataQ,this._perfMonitor)},instance:null},FilesFeature:{configKey:"isFilesFeature",shouldRun:!0,isFrameRelated:!1,runInUns:!1,isRunning:!1,init:function(){this._features.perSessionFeatures.FilesFeature.instance=new e.FilesFeature(this._configMgr,this._utils,this._sessionMgr,this._muidMgr,this._perfMonitor)},instance:null},UserPermissions:{configKey:"isUserPermissions",shouldRun:!0,isFrameRelated:!1,runInUns:!1,isRunning:!1,init:function(){this._features.perSessionFeatures.UserPermissions.instance=new e.UserPermissions(this._dataQ,this._perfMonitor)},instance:null},MediaDevicesFeature:{configKey:"isMediaDevices",shouldRun:!0,isFrameRelated:!1,runInUns:!1,isRunning:!1,init:function(){this._features.perSessionFeatures.MediaDevicesFeature.instance=new e.MediaDevicesFeature(this._dataQ,this._perfMonitor)},instance:null}},perContextFeatures:{ElementEvents:{configKey:"isElementsEvent",shouldRun:!0,isFrameRelated:!1,runInUns:!1,isRunning:!0,init:function(){this._features.perContextFeatures.ElementEvents.instance=this._features.defaultFeatures.ElementEvents.instance},instance:null},ContextPropsFeature:{configKey:"isContextPropsFeature",shouldRun:!0,isFrameRelated:!1,isRunning:!1,runInUns:!0,init:function(){this._features.perContextFeatures.ContextPropsFeature.instance=new e.ContextPropsFeature(this._dataQ,this._perfMonitor,this._utils)},instance:null},ScriptsFeature:{configKey:"isScriptsFeature",shouldRun:!0,isFrameRelated:!1,isRunning:!1,runInUns:!0,init:function(){this._features.perContextFeatures.ScriptsFeature.instance=new e.ScriptsFeature(this._utils,this._dataQ,this._perfMonitor)},instance:null}},perPageReloadFeatures:{},nonDefaultFeatures:{AccelerometerEvents:{configKey:"isAccelerometerEvents",shouldRun:!0,isFrameRelated:!1,runInUns:!1,isRunning:!1,init:function(){this._features.nonDefaultFeatures.AccelerometerEvents.instance=new e.AccelerometerEvents(this._configMgr,this._utils,this._sensorDataQ,this._perfMonitor)},instance:null},PortScannerFeature:{configKey:"isPortScanner",shouldRun:!0,isFrameRelated:!1,runInUns:!0,isRunning:!1,init:function(){this._features.nonDefaultFeatures.PortScannerFeature.instance=new e.PortScannerFeature(this._dataQ,this._configMgr,this._perfMonitor)},instance:null},OrientationEvents:{configKey:"isOrientationEvents",shouldRun:!0,isFrameRelated:!1,runInUns:!1,isRunning:!1,init:function(){this._features.nonDefaultFeatures.OrientationEvents.instance=new e.OrientationEvents(this._configMgr,this._utils,this._sensorDataQ,this._perfMonitor)},instance:null},ScriptEvents:{configKey:"isScriptExecuteEve",shouldRun:!0,isFrameRelated:!1,runInUns:!1,isRunning:!1,init:function(){this._features.nonDefaultFeatures.ScriptEvents.instance=new e.ScriptEvents(this._utils,this._dataQ,this._perfMonitor)},instance:null},MouseChallengeFeature:{configKey:"isChallengeFeature",shouldRun:!0,isFrameRelated:!1,runInUns:!1,isRunning:!1,init:function(){var t=new e.SiteMapper(MutationObserver,this._utils,this._perfMonitor,"challengeConfig");this._features.nonDefaultFeatures.MouseChallengeFeature.instance=new e.MouseChallengeFeature(this._configMgr,this._utils,this._dataQ,t)},instance:null},NetInfoEvents:{configKey:"isNetInfoEvents",shouldRun:!0,isFrameRelated:!1,runInUns:!1,isRunning:!1,init:function(){this._features.nonDefaultFeatures.NetInfoEvents.instance=new e.NetInfoEvents(this._utils,this._dataQ,this._perfMonitor)},instance:null},ScreenOrientationEvents:{configKey:"isScreenOrientationEvents",shouldRun:!0,isFrameRelated:!1,runInUns:!1,isRunning:!1,init:function(){this._features.nonDefaultFeatures.ScreenOrientationEvents.instance=new e.ScreenOrientationEvents(this._configMgr,this._utils,this._dataQ,this._perfMonitor)},instance:null},TapEvents:{configKey:"isTapEvents",shouldRun:!0,isFrameRelated:!0,runInUns:!1,runInSlave:!0,isRunning:!1,init:function(){this._features.nonDefaultFeatures.TapEvents.instance=new e.TapEvents(this._configMgr,this._utils,this._elements,this._dataQ,this._perfMonitor)},instance:null}}}}(i),function(e){function t(t,n,i){log.trace("FeatureManager:ctor"),this._collectFrameRelated=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&e[n].isFrameRelated&&t.push(e[n]);return t},this._runFeatures=function(t,n){var i=this;log.trace("FeatureManager:_runFeatures");for(var s in t)t.hasOwnProperty(s)&&t[s].shouldRun&&!t[s].isFrameRelated&&(t[s].instance.startFeature.cdCallAsync(t[s].instance,window.self),t[s].isRunning=!0);if(n){for(var r=0,a=n.length;r<a;r++)n[r].shouldRun&&(n[r].instance.startFeature.cdCallAsync(n[r].instance,window.self),n[r].isRunning=!0);this._frameHandler.startFeatures(n),e.CDUtils.DomUtils.onPageLoad(window,function(){i._frameHandler.startFeatures(n)})}},this._stopFeatures=function(e,t){log.trace("FeatureManager:_stopFeatures");for(var n in e)e.hasOwnProperty(n)&&(e[n].isFrameRelated||(e[n].instance.stopFeature&&e[n].instance.stopFeature.cdCallAsync(e[n].instance),e[n].isRunning=!1));if(t){for(var i=0,s=t.length;i<s;i++)t[i].instance.stopFeature.cdCallAsync(t[i].instance),t[i].isRunning=!1;this._frameHandler.stopFeatures(t)}},this._actOnFeature=function(e,t){log.trace("FeatureManager:_actOnFeature"),e.isFrameRelated&&this._frameHandler[t](e),e.instance[t]&&e.instance[t].cdCallAsync(e.instance)},this._updateFeatures=function(e,t){log.trace("FeatureManager:_updateFeatures");for(var n in e)if(e.hasOwnProperty(n)){var i=e[n],s=t.get(i.configKey);"boolean"==typeof s&&(i.shouldRun=s),i.isRunning&&!i.shouldRun?(this._actOnFeature(i,"stopFeature"),i.isRunning=!1):!i.isRunning&&i.shouldRun&&(this._actOnFeature(i,"startFeature"),i.isRunning=!0),i.isRunning&&this._actOnFeature(i,"updateFeatureConfig")}},this._features=t,this._frameHandler=n,this._configManager=i,this._frameRelatedDefaultFeatures=this._collectFrameRelated(t.defaultFeatures),this._frameRelatedNonDefaultFeatures=this._collectFrameRelated(t.nonDefaultFeatures)}t.prototype.runDefault=function(){log.trace("FeatureManager:runDefault"),this._runFeatures(this._features.defaultFeatures,this._frameRelatedDefaultFeatures)},t.prototype.stopDefault=function(){log.trace("FeatureManager:stopDefault"),this._stopFeatures(this._features.defaultFeatures,this._frameRelatedDefaultFeatures)},t.prototype.runPerSessionFeatures=function(){log.trace("FeatureManager:runPerSessionFeatures"),this._configManager.isConfigurationUpdatedFromServer()?this._runFeatures(this._features.perSessionFeatures):log.info("We didn't receive configurations from the server yet. Skipping per session features start until configuration arrives.")},t.prototype.stopPerSessionFeatures=function(){log.trace("FeatureManager:stopPerSessionFeatures"),this._stopFeatures(this._features.perSessionFeatures)},t.prototype.runNonDefault=function(){log.trace("FeatureManager:runNonDefault"),this._configManager.isConfigurationUpdatedFromServer()?this._runFeatures(this._features.nonDefaultFeatures,this._frameRelatedNonDefaultFeatures):log.info("We didn't receive configurations from the server yet. Skipping non default features start until configuration arrives.")},t.prototype.stopNonDefault=function(){log.trace("FeatureManager:stopNonDefault"),this._stopFeatures(this._features.nonDefaultFeatures,this._frameRelatedNonDefaultFeatures)},t.prototype.runPerContextFeatures=function(e){log.trace("FeatureManager:runPerContextFeatures"),this._configManager.isConfigurationUpdatedFromServer()?(this._runFeatures(this._features.perContextFeatures),"cd_auto"!==e.name&&this._frameRelatedDefaultFeatures&&this._frameHandler.startFeatures(this._frameRelatedDefaultFeatures)):log.info("We didn't receive configurations from the server yet. Skipping per context features start until configuration arrives.")},t.prototype.stopPerContextFeatures=function(){log.trace("FeatureManager:stopPerContextFeatures"),this._stopFeatures(this._features.perContextFeatures)},t.prototype.stopAllFeatures=function(){log.trace("FeatureManager:stopAllFeatures"),this.stopDefault(),this.stopNonDefault(),this.stopPerSessionFeatures(),this.stopPerContextFeatures()},t.prototype.updateRunByConfig=function(e){log.trace("FeatureManager:updateRunByConfig"),this._updateFeatures(this._features.defaultFeatures,e),this._updateFeatures(this._features.nonDefaultFeatures,e),this._updateFeatures(this._features.perContextFeatures,e),this._updateFeatures(this._features.perSessionFeatures,e)},e.FeatureManager=t}(i),function(e){function t(e,t,n,i,s,r,a,o,u,c,l){this._configMgr=t,this._utils=n,this._elements=i,this._mutationObserver=s,this._dataQ=r,this._features=e,this._sessionMgr=a,this._muidMgr=o,this._perfMonitor=u,this._sensorDataQ=c,this._msgBus=l}Object.extend(t,{BUILD_DEFAULT_ONLY:1,BUILD_NON_DEFAULT_ONLY:2,BUILD_PER_SESSION_ONLY:4,BUILD_PER_PAGE_RELOAD_ONLY:8,BUILD_PER_CONTEXT_ONLY:16}),t.BUILD_ALL=t.BUILD_DEFAULT_ONLY|t.BUILD_NON_DEFAULT_ONLY|t.BUILD_PER_SESSION_ONLY|t.BUILD_PER_PAGE_RELOAD_ONLY|t.BUILD_PER_CONTEXT_ONLY,t.prototype.buildFeatures=function(e){function n(e){for(var t in e)e.hasOwnProperty(t)&&e[t].init.apply(i)}var i=this;e&t.BUILD_DEFAULT_ONLY&&n(this._features.defaultFeatures),e&t.BUILD_PER_SESSION_ONLY&&n(this._features.perSessionFeatures),e&t.BUILD_NON_DEFAULT_ONLY&&n(this._features.nonDefaultFeatures),e&t.BUILD_PER_PAGE_RELOAD_ONLY&&n(this._features.perPageReloadFeatures),e&t.BUILD_PER_CONTEXT_ONLY&&n(this._features.perContextFeatures)},e.FeaturesBuilder=t}(i),function(e){var t=function(){function t(i,s,r){n(this,t),this._utils=i,this._contextSiteMapper=s,this.contextName="",this.referrer="",this.historyLen=-1,this.changeTimestamp=0,this.onContextChange=new e.CDEvent,this._contextSiteMapper.updateObserver(this.onSiteMapperMatch.bind(this)),this._workerComm=r}return r(t,[{key:"contextData",value:function(){return{contextId:this.contextId,url:this.url,name:this.contextName,referrer:this.referrer,hLength:this.historyLen,timestamp:this.timestamp}}},{key:"setContext",value:function(e){this.contextName=e.name,this._genContext(),this.url=e.url,this.referrer=e.referrer,this.historyLen=e.hLength,this.timestamp=e.timestamp,this._publishContext()}},{key:"_publishContext",value:function(){this.onContextChange.publish(this.contextData());var t={fields:{context_name:this.contextName},updateParams:!0};this._workerComm.sendAsync(e.WorkerCommand.updateSessionParamsCommand,t)}},{key:"changeContext",value:function(e){return log.trace("ContextMgr:changeContext"),e&&e!==this.contextName&&(this.contextName=e,this._updateContext(),this._publishContext()),null}},{key:"onSiteMapperMatch",value:function(e){log.trace("ContextMgr:onSiteMapperMatch"),this.changeContext(e.contextName)}},{key:"_updateContext",value:function(){this._genContext(),this.url=this._utils.getDocUrl(),this.referrer=e.CDUtils.clearTextFromNumbers(document.referrer),this.historyLen=window.history.length,this.timestamp=this._utils.dateNow()}},{key:"_genContext",value:function(){log.trace("ContextMgr:_genContext"),this.contextId=this._utils.StorageUtils.getCookie("cdContextId"),this.contextId?this.contextId=parseInt(this.contextId):this.contextId=0,this._utils.StorageUtils.setCookie("cdContextId",this.contextId+1),log.debug("ContextMgr:_genContext. contextId="+this.contextId)}},{key:"initContextHandling",value:function(){this._contextSiteMapper.initTracking()}},{key:"clearContextHandling",value:function(){this._contextSiteMapper.stopTracking()}},{key:"onConfigUpdate",value:function(e){log.trace("ContextMgr:onConfigUpdate"),this._contextSiteMapper.onConfigUpdate(e)}}]),t}();e.ContextMgr=t}(i),function(e){function t(){log.trace("ConfigManager:constructor"),this._configurationList={},this.configUpdate=new e.CDEvent,this.configDefault={wupsSendRate:5e3,logLevel:e.Logger.LOG_LEVEL.WARN,orientationEventsSamplePeriod:300,orientationEventsThreshold:1,stateChangeEnabled:!1,accelerometerEventsSamplePeriod:0,dataQPassWorkerInterval:500,gyroEventsSamplePeriod:0,gyroEventsThreshold:.3,isContextPropsFeature:!0,isEnabled:!0,isResetEveryLoad:!1,isScrollCollect:!0,isUnsupportedReport:!0,isUsingCsid:!0,isUsingResetSid:!1,isVMDetection:!0,isAudioDetection:!0,sidTimeoutMinutes:30},this._cid="",this.updateConfiguration(this.configDefault)}e.ConfigManager||(t.prototype.isConfigurationUpdatedFromServer=function(){return!this._isDefaultConfiguration},t.prototype.updateConfiguration=function(e){log.trace("ConfigManager:updateConfiguration"),this._isDefaultConfiguration=e===this.configDefault;for(var t in e)e.hasOwnProperty(t)&&(this._configurationList[t]=e[t]);this.configUpdate.publish(this)},t.prototype.updateLogUrlToWorker=function(t,n,i){if(this._configurationList.logAddress&&t){var s={logAddress:this._configurationList.logAddress+"?cid="+this._cid+"&cdsnum="+t+"&csid="+n};i.sendAsync(e.WorkerCommand.updateLogUrlCommand,s)}},t.prototype.getServerConfig=function(t,n,i,s){function r(e){log.warn("Config Manager received an error response for Init request from Worker."),a.updateConfiguration(a.configDefault),s&&s(e)}log.trace("ConfigManager:getServerConfig");var a=this;this._configurationList.serverAddress=n.serverAddress;var o=n.serverState?n.serverState.requestId:0,u=n.serverAddress.indexOf("cid=")+4,c=n.serverAddress.indexOf("&",u);c=-1==c?undefined:c,this._cid=n.serverAddress.substring(u,c);var l={msgType:"initComm",serverAddress:n.serverAddress,csid:n.customerSessionId,cdsnum:n.sessionId,muid:n.muid,context_name:n.context_name,serverState:n.serverState,requestId:o,wupType:"js"};log.info("Config Manager is requesting configuration from Worker."),t.addMessageListener("initCommFailed",r,!0),t.sendAsync(e.WorkerCommand.initCollectionCommand,l,"initCommSuccess",function(e){log.info("Config Manager received Init response from Worker."),e?(log.info("Updating received configuration and notifying on the change."),a.updateConfiguration(e),a._configurationList.logAddress&&a.updateLogUrlToWorker(n.sessionId,n.customerSessionId,t),i&&i(e)):r(e)},!0)},t.prototype.get=function(e){return log.trace("ConfigManager:get"),this._configurationList[e]},t.prototype.setSingleConfiguration=function(e,t){log.trace("ConfigManager:setSingleConfiguration"),this._configurationList[e]=t},t.prototype.getAllConfigs=function(){return log.trace("ConfigManager:getAllConfigs"),this._configurationList},e.ConfigManager=t)}(i),function(e){function t(t,n,i,s,r){var a=this;this._sendQToServerWorker=function(){this._Q.length&&(this._serverWorkerCommunicator.sendAsync(this._msgToWorker,this._Q),this._Q=[])},this._onUnload=function(){this._Q.push({eventName:"flushData"}),this._sendQToServerWorker()},this._serverWorkerCommunicator=t,this._contextManager=n,this._passToWorkerInterval=r||0,this._intervalConfigKey=i,this._msgToWorker=s,this._Q=[],this._passToWorkerInterval&&(this._intervalId=setInterval(this._sendQToServerWorker.bind(this),this._passToWorkerInterval)),e.CDUtils.addEventListener(window,"beforeunload",function(){a._onUnload()},!0)}t.prototype.addToQueue=function(e,t,n,i){(n=!(n!==undefined&&null!==n&&!0!==n))&&t.push&&(t[0]=this._contextManager.contextId),0!==this._passToWorkerInterval?(this._Q.push({eventName:e,data:t,shouldFlush:i}),i&&this._sendQToServerWorker()):this._serverWorkerCommunicator.sendAsync(this._msgToWorker,{eventName:e,data:t,shouldFlush:i})},t.prototype.updateWithConfig=function(e){log.trace("DataQ:updateWithConfig");var t=e.get(this._intervalConfigKey);t!==undefined&&t!==this._passToWorkerInterval&&(this._passToWorkerInterval=t,clearInterval(this._intervalId),this._intervalId=null,0!==this._passToWorkerInterval&&(this._intervalId=setInterval(this._sendQToServerWorker.bind(this),this._passToWorkerInterval)))},e.DataQ=t}(i),function(e){var t=function(){function t(){n(this,t),this._msgListeners=new e.Map,this._windowId="Window_"+e.CDUtils.generateUUID(),e.CDUtils.addEventListener(window,"message",this._onMessageReceived.bind(this),!0)}return r(t,[{key:"subscribe",value:function(t,n){var i=arguments.length>2&&arguments[2]!==undefined&&arguments[2],s=null;this._msgListeners.has(t)?s=this._msgListeners.get(t):(s=new e.Set,this._msgListeners.set(t,s)),s.add({callback:n,isOneTime:i})}},{key:"unsubscribe",value:function(e,t){if(e&&this._msgListeners.has(e)){var n=this._msgListeners.get(e);n&&n.forEach(function(e){t===e.callback&&n["delete"](e)}),0===n.size&&this._msgListeners["delete"](e)}}},{key:"publish",value:function(e,t,n,i,s,r){s&&i&&this.subscribe(i,s,r),n?window.postMessage({msgID:this._windowId,msgType:e,data:t},window.location.href):this._receiveMessage({msgType:e,data:t})}},{key:"_receiveMessage",value:function(e){var t=e.msgType;if(t&&this._msgListeners.has(t)){var n=this._msgListeners.get(t);n&&n.forEach(function(t){t.callback(e.data),t.isOneTime&&n["delete"](t)})}}},{key:"_onMessageReceived",value:function(e){e.data.msgID&&e.data.msgID===this._windowId&&(e.stopPropagation&&e.stopPropagation(),e.returnValue&&(e.returnValue=!1),e.cancelBubble&&(e.cancelBubble=!0),this._receiveMessage(e.data))}}]),t}();e.MessageBus=t}(i),function(e){var t=function(){function e(t,i,s){n(this,e),this._featureMgr=t,this._dataQ=s,this._confMgr=i,this._pauseResumeEnabled=i.get("stateChangeEnabled")||!1,this._sdkState=e.STATE.RUNNING}return r(e,[{key:"onResume",value:function(){log.trace("PauseResumeManager:onResume"),this._sdkState==e.STATE.PAUSED?(log.info("PauseResumeManager:onResume - Resuming JS SDK"),this._featureMgr.updateRunByConfig(this._confMgr),this._sdkState=e.STATE.RUNNING):log.warn("PauseResumeManager:onResume - resume api called when SDK already running")}},{key:"onPause",value:function(){log.trace("PauseResumeManager:onPause"),this._sdkState==e.STATE.RUNNING?(log.info("PauseResumeManager:onPause - Pausing JS SDK"),this._featureMgr.stopAllFeatures(),this._sdkState=e.STATE.PAUSED):log.warn("PauseResumeManager:onPause - pause api called when SDK already paused")}},{key:"onStateChange",value:function(e){log.trace("PauseResumeManager:onStateChange"),e.toState&&this._verifyApiAllowed(e.toState)&&("pause"===e.toState?this.onPause():"run"===e.toState?this.onResume():log.warn("PauseResumeManager:onStateChange - api called with non valid toState: "+e.toState))}},{key:"isCustomerApiEnabled",value:function(){return log.trace("PauseResumeManager:isCustomerApiEnabled"),this._sdkState==e.STATE.RUNNING}},{key:"_verifyApiAllowed",value:function(e){return!!this._pauseResumeEnabled||(this._dataQ.addToQueue("forbidden_api_call",[null,e]),!1)}},{key:"onConfigUpdate",value:function(){log.trace("PauseResumeManager:onConfigUpdate"),this._pauseResumeEnabled=this._confMgr.get("stateChangeEnabled")||!1,!1===this._confMgr.get("isEnabled")&&this.onPause()}}]),e}();Object.extend(t,{STATE:{RUNNING:0,PAUSED:1}}),e.PauseResumeManager=t}(i),function(e){var t=function(){function e(t,i,s,r,a){var o=!(arguments.length>5&&arguments[5]!==undefined)||arguments[5];n(this,e),this._mutationObserver=t,this._siteMapKey=r,this._perfMonitor=s,this._stopOnFirstMappingMatch=o,this._siteMap=null,this._observers=[],this._utils=i,this._onMatchCB=a,this._maxMappings=200,this._maxTriggers=10}return r(e,[{key:"updateObserver",value:function(e){this._onMatchCB=e}},{key:"_observeChange",value:function(e,t){if(e)try{var n=window.document.querySelector(e);if(n){var i=new this._mutationObserver(function(e){log.trace("SiteMapper:_mutationObserver cb"),e.length>0&&t()});i.observe(n,{childList:!0,characterData:!0,attributes:!0,subtree:!0}),this._observers.push(i)}else log.error("SiteMapper._observeChange selector:"+JSON.stringify(e)+" not found on page")}catch(s){log.error("SiteMapper._observeChange: "+s.message,s)}}},{key:"initTracking",value:function(){var e=this,t=function(){try{e._perfMonitor.startMonitor("siteMapperTrack_"+e._siteMapKey);for(var t=0;t<e._siteMap.mappings.length;t++){var n=e._siteMap.mappings[t];if(!n.url||e.url.indexOf(n.url)>-1)if(n.selector){var i=window.document.querySelector(n.selector);if(i)if(n.byText){if((i.innerText!==undefined&&-1!==i.innerText.indexOf(n.byText)||i.value===n.byText)&&(e._perfMonitor.stopMonitor("siteMapperTrack_"+e._siteMapKey),e._onMatchCB(n),e._stopOnFirstMappingMatch))return}else if(e._perfMonitor.stopMonitor("siteMapperTrack_"+e._siteMapKey),e._onMatchCB(n),e._stopOnFirstMappingMatch)return}else if(e.url.indexOf(n.url)>-1&&(e._perfMonitor.stopMonitor("siteMapperTrack_"+e._siteMapKey),e._onMatchCB(n),e._stopOnFirstMappingMatch))return}}catch(s){e._perfMonitor.cancelMonitor("siteMapperTrack_"+e._siteMapKey),log.error("SiteMapper:testQuerySelector failed. ex:"+s.message,s)}};if(!this._siteMap){var n=this._utils.StorageUtils.getFromSessionStorage(this._siteMapKey);n&&n.triggers.length<=this._maxTriggers&&n.mappings.length<=this._maxMappings&&(this._siteMap=n)}this._siteMap&&this._utils.DomUtils.onDocumentBody(window,function(){e.url=e._utils.getDocUrl(),e._mutationObserver&&e._siteMap.triggers.forEach(function(n){(!n.url||e.url.indexOf(n.url)>-1)&&e._observeChange(n.selector,t)}),t()})}},{key:"onConfigUpdate",value:function(e){log.trace("SiteMapper:onConfigUpdate");try{if(!this._siteMap&&e.get(this._siteMapKey)){this.stopTracking();var t=e.get(this._siteMapKey)&&JSON.parse(e.get(this._siteMapKey));t&&t.triggers.length<=this._maxTriggers&&t.mappings.length<=this._maxMappings?(this._siteMap=t,this._utils.StorageUtils.saveToSessionStorage(this._siteMapKey,this._siteMap),this.initTracking()):log.warn("Configuration "+this._siteMapKey+" contains an illegal amount of triggers or mappings. Max Allowed Triggers: "+this._maxTriggers+", Max Allowed Mappings: "+this._maxMappings)}}catch(n){log.error("SiteMapper:onConfigUpdate: "+n.message,n)}}},{key:"stopTracking",value:function(){for(var e=0;e<this._observers.length;e++)this._observers[e].disconnect();this._observers=[],this._siteMap=null}}]),e}();e.SiteMapper=t}(i),function(i){i.ParentCommunicator=function(s){function a(){n(this,a);var t=e(this,(a.__proto__||Object.getPrototypeOf(a)).call(this));return t.setMessagingPort(t),t._slaves=[],t._msgRouter={dataFromSlave:t._onDataFromSlave,registerSlave:t._onRegisterSlave,updateSlaveConf:t._onUpdateSlaveConf,updateSlaveState:t._onUpdateSlaveState,updateMasterContext:t._onUpdateMasterContext,resetSessionTriggerFromSlave:t._onResetSessionTriggerFromSlave,mouseChallengeTriggerFromSlave:t._onMouseChallengeTriggerFromSlave},t}return t(a,i.WorkerCommunicator),r(a,[{key:"setonmessage",value:function(e){this._workerCommCallback=e}},{key:"registerToParent",value:function(){var e=this;log.info("ParentRegisterer:registerToParent - registering to parent from slave. url: "+window.location.href),i.CDUtils.addEventListener(window,"message",function(t){if(t.source!==window||t.data&&t.data.isNative){var n=t.data.msgType;n&&e._msgRouter[n]&&e._msgRouter[n].call(e,t)}}),this.sendToParent({msgType:"registerSlave"})}},{key:"sendToParent",value:function(e){window.parent.postMessage(e,"*")}},{key:"sendToSlaves",value:function(e){log.debug("ParentCommunicator:sendToSlaves"),this._slaves.forEach(function(t){t.source.postMessage(e,t.origin)})}},{key:"notifyContextChange",value:function(e){"slave_cd_auto"!==e.name&&this.sendAsync(i.EnumDefs.MasterSlaveMessage.updateMasterContext,e)}},{key:"notifyResetSession",value:function(e){this.sendAsync(i.EnumDefs.MasterSlaveMessage.resetSessionTriggerFromSlave,e)}},{key:"notifyMouseChallenge",value:function(e){this.sendAsync(i.EnumDefs.MasterSlaveMessage.mouseChallengeTriggerFromSlave,e)}},{key:"sendAsync",value:function(e,t){this.sendToParent({msgType:e,data:t})}},{key:"_onDataFromSlave",value:function(e){this.sendToParent(e.data)}},{key:"_onRegisterSlave",value:function(e){log.debug("ParentCommunicator:_onRegisterSlave - registering a sub slave"),this._slaves.push({source:e.source,origin:e.origin}),this.sendToParent(e.data)}},{key:"_onUpdateSlaveConf",value:function(e){log.debug("ParentCommunicator:_onUpdateSlaveConf - got config"),this.sendToSlaves(e.data),this._workerCommCallback(e)}},{key:"_onUpdateSlaveState",value:function(e){log.debug("ParentCommunicator:_onUpdateSlaveState"),this.sendToSlaves(e.data),this._workerCommCallback(e)}},{key:"_onUpdateMasterContext",value:function(e){log.debug("ParentCommunicator:_onUpdateMasterContext"),this.sendToParent(e.data)}},{key:"_onResetSessionTriggerFromSlave",value:function(e){log.debug("ParentCommunicator:_onResetSessionTriggerFromSlave"),this.sendToParent(e.data)}},{key:"_onMouseChallengeTriggerFromSlave",value:function(e){log.debug("ParentCommunicator:_onMouseChallengeTriggerFromSlave"),this.sendToParent(e.data)}}]),a}()}(i),function(i){var a=function(){function a(){n(this,a)}return r(a,[{key:"loadSystem",value:function(a,o){function u(e){for(var t in e)e.hasOwnProperty(t)&&!e[t].runInSlave&&delete e[t]}u(a.defaultFeatures),u(a.nonDefaultFeatures),u(a.perSessionFeatures),u(a.perContextFeatures),u(a.perPageReloadFeatures),this._parentCommunicator=new i.ParentCommunicator;var c=new i.DataQ(this._parentCommunicator,null,null,"logPerfSlave"),l=this._perfMonitor=new(function(a){function o(){return n(this,o),e(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,c))}return t(o,i.PerfMonitor),r(o,[{key:"stopMonitor",value:function(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"slave:"+self.location.href;s(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"stopMonitor",this).call(this,e,t)}}]),o}()),h=new i.SiteMapper(self.MutationObserver,i.CDUtils,l,"contextConfiguration"),d=this._contextMgr=new i.ContextMgr(i.CDUtils,h,this._parentCommunicator),f=new(function(){function e(){n(this,e)}return r(e,[{key:"log",value:function(e,t){c.addToQueue("log",{msg:"SLAVE: "+e,url:d.url,level:t,sn:this.sn++})}}]),e}());f.sn=0;var p=new i.Logger(f);o.setLogger(p),this._configManager=new i.ConfigManager,this._parentCommunicator.addMessageListener(i.EnumDefs.MasterSlaveMessage.updateSlaveConf,this._configManager.updateConfiguration.bind(this._configManager)),this._dataQ=new i.DataQ(this._parentCommunicator,this._contextMgr,null,"dataFromSlave"),this._msgBus=new i.MessageBus,this._sensorDataQ=new i.SensorsDataQueue(this._configManager,this._dataQ,this._msgBus),"undefined"!=typeof WeakMap&&window.Worker?this._elementsUtils=new i.Elements(this._configManager,i.CDUtils,this._dataQ,l):(log.warn("slave moving to unsupported mode in slave since there is no weak map"),this._unsupportedMgr=new i.UnsupportedMgr(null),this._unsupportedMgr.adjustFeatureList(a)),this._framesCache=new i.FramesCache,this._framesDetector=new i.FramesDetector(self.MutationObserver,i.CDUtils),this._frameHandler=this._unsupportedMgr?this._unsupportedMgr.getUnsFrameHandler():new i.FramesHandler(this._framesCache,this._framesDetector),this._featureManager=new i.FeatureManager(a,this._frameHandler,this._configManager),this._pauseResumeMgr=new i.PauseResumeManager(this._featureManager,this._configManager,this._dataQ),this._parentCommunicator.addMessageListener(i.EnumDefs.MasterSlaveMessage.updateSlaveState,this._pauseResumeMgr.onStateChange.bind(this._pauseResumeMgr)),this._featureBuilder=new i.FeaturesBuilder(a,this._configManager,i.CDUtils,this._elementsUtils,self.MutationObserver,this._dataQ,null,null,l,this._sensorDataQ,this._msgBus),this._contextMgr.onContextChange.subscribe(this._featureManager.runPerContextFeatures.bind(this._featureManager)),this._contextMgr.onContextChange.subscribe(this._parentCommunicator.notifyContextChange.bind(this._parentCommunicator));var _=new i.SiteMapper(self.MutationObserver,i.CDUtils,l,"resetSessionConfig");this._slaveResetSessionDetector=new i.SlaveResetSessionDetector(_),this._slaveResetSessionDetector.onResetSession.subscribe(this._parentCommunicator.notifyResetSession.bind(this._parentCommunicator));var g=new i.SiteMapper(self.MutationObserver,i.CDUtils,l,"challengeConfig");this._slaveMouseChallengeDetector=new i.SlaveMouseChallengeDetector(g),this._slaveMouseChallengeDetector.onMouseChallengeTrigger.subscribe(this._parentCommunicator.notifyMouseChallenge.bind(this._parentCommunicator)),this._configManager.configUpdate.subscribe(this._featureManager.updateRunByConfig.bind(this._featureManager)),this._configManager.configUpdate.subscribe(this._dataQ.updateWithConfig.bind(this._dataQ)),this._configManager.configUpdate.subscribe(this._pauseResumeMgr.onConfigUpdate.bind(this._pauseResumeMgr)),this._configManager.configUpdate.subscribe(p.updateLogConfig.bind(p)),this._configManager.configUpdate.subscribe(this._contextMgr.onConfigUpdate.bind(this._contextMgr)),this._configManager.configUpdate.subscribe(this._slaveResetSessionDetector.onConfigUpdate.bind(this._slaveResetSessionDetector)),this._configManager.configUpdate.subscribe(this._slaveMouseChallengeDetector.onConfigUpdate.bind(this._slaveMouseChallengeDetector)),this._contextMgr.changeContext("slave_cd_auto")}},{key:"getConfigManager",value:function(){return this._configManager}},{key:"getFeatureBuilder",value:function(){return this._featureBuilder}},{key:"getFeatureManager",value:function(){return this._featureManager}},{key:"getContextMgr",value:function(){return this._contextMgr}},{key:"getParentCommunicator",value:function(){return this._parentCommunicator}}]),a}();i.SlaveSystemLoader=a}(i),function(e){e.startSlave=function(){var t=new e.SlaveSystemLoader;return t.loadSystem(e.FeaturesList,e.log),this.confManager=t.getConfigManager(),t.getFeatureBuilder().buildFeatures(e.FeaturesBuilder.BUILD_ALL),t.getFeatureManager().runDefault(),t.getContextMgr().initContextHandling(),log.info("Started default features collection"),t.getParentCommunicator().registerToParent(),t}}(i),function(e){var t=function(){function t(i){n(this,t),this._resetSessionSiteMapper=i,this._resetSessionSiteMapper.updateObserver(this._onSiteMapperMatch.bind(this)),this.onResetSession=new e.CDEvent}return r(t,[{key:"onConfigUpdate",value:function(e){log.trace("SlaveResetSessionDetector:onConfigUpdate"),e.get("isSlaveResetSessionDetectionEnabled")===undefined||e.get("isSlaveResetSessionDetectionEnabled")?this._resetSessionSiteMapper.onConfigUpdate(e):this._resetSessionSiteMapper.stopTracking()}},{key:"_onSiteMapperMatch",value:function(){log.trace("SlaveResetSessionDetector:_onSiteMapperMatch"),log.info("Slave detected a reset session from configuration."),this.onResetSession.publish({resetReason:e.EnumDefs.SNUM_CHANGE_TYPE.configurationFromSlave})}}]),t}();e.SlaveResetSessionDetector=t}(i),function(e){var t=function(){function t(i){n(this,t),this._mouseChallengeSiteMapper=i,this._mouseChallengeSiteMapper.updateObserver(this._onSiteMapperMatch.bind(this)),this.onMouseChallengeTrigger=new e.CDEvent}return r(t,[{key:"onConfigUpdate",value:function(e){log.trace("SlaveMouseChallengeDetector:onConfigUpdate"),e.get("isSlaveMouseChallengeDetectionEnabled")===undefined||e.get("isSlaveMouseChallengeDetectionEnabled")?this._mouseChallengeSiteMapper.onConfigUpdate(e):this._mouseChallengeSiteMapper.stopTracking()}},{key:"_onSiteMapperMatch",value:function(e){log.trace("SlaveMouseChallengeDetector:_onSiteMapperMatch"),log.info("Slave detected a mouse challenge required from configuration."),e.timers&&this.onMouseChallengeTrigger.publish(e.timers)}}]),t}();e.SlaveMouseChallengeDetector=t}(i);var log=i.log;i.startSlave()}}();
//# sourceMappingURL=slave2.4.0.3282.d394953.min.js.map